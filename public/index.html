<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesture & Voice Control App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- TensorFlow.js and Handpose model -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
    <!-- Chart.js for analytics visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Translations file -->
    <script src="translations.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .card-header {
            background-color: #4F46E5;
            color: white;
            font-weight: bold;
        }
        
        .gesture-icon {
            width: 60px;
            height: 60px;
            background-color: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4F46E5;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .nav-tabs {
            margin-bottom: 20px;
        }
        
        .nav-tabs .nav-link.active {
            background-color: #4F46E5;
            color: white;
            border-color: #4F46E5;
        }
        
        .nav-tabs .nav-link {
            color: #4F46E5;
        }
        
        .command-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .badge {
            margin-left: 10px;
        }
        
        .progress {
            height: 10px;
            margin: 15px 0;
        }
        
        .btn-primary {
            background-color: #4F46E5;
            border-color: #4F46E5;
        }
        
        .btn-outline-primary {
            color: #4F46E5;
            border-color: #4F46E5;
        }
        
        .btn-outline-primary:hover {
            background-color: #4F46E5;
            color: white;
        }
        
        .btn-danger {
            background-color: #EF4444;
            border-color: #EF4444;
        }
        
        .btn-outline-danger {
            color: #EF4444;
            border-color: #EF4444;
        }
        
        .dark-mode {
            background-color: #1F2937;
            color: #F9FAFB;
        }
        
        .dark-mode .card {
            background-color: #374151;
            border-color: #4B5563;
        }
        
        /* Gesture Detector Styles */
        .gesture-detector {
            margin-bottom: 20px;
        }
        
        .video-container {
            position: relative;
            width: 320px;
            height: 240px;
            margin: 0 auto;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .gesture-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .gesture-indicator {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 8px;
        }
        
        .loading, .error-message {
            text-align: center;
            padding: 20px;
        }
        
        .dark-mode .card-header {
            background-color: #4338CA;
            border-color: #4338CA;
        }
        
        /* RTL Support for Arabic */
        html[dir="rtl"] body {
            text-align: right;
            font-family: 'Tajawal', sans-serif;
        }
        
        html[dir="rtl"] .nav-tabs {
            padding-right: 0;
        }
        
        html[dir="rtl"] .me-2 {
            margin-right: 0 !important;
            margin-left: 0.5rem !important;
        }
        
        html[dir="rtl"] .me-3 {
            margin-right: 0 !important;
            margin-left: 1rem !important;
        }
        
        html[dir="rtl"] .ms-2 {
            margin-left: 0 !important;
            margin-right: 0.5rem !important;
        }
        
        html[dir="rtl"] .ms-3 {
            margin-left: 0 !important;
            margin-right: 1rem !important;
        }
        
        html[dir="rtl"] .gesture-icon {
            margin-right: 0;
            margin-left: 15px;
        }
        
        html[dir="rtl"] .text-end {
            text-align: left !important;
        }
        
        html[dir="rtl"] .slider:before {
            transform: translateX(-26px);
            left: auto;
            right: 4px;
        }
        
        html[dir="rtl"] input:checked + .slider:before {
            transform: translateX(0);
        }
        
        /* Game styles */
        #gameGestureDetector {
            position: relative;
            min-height: 300px;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f5f5f5;
        }
        
        .gesture-video {
            width: 100%;
            height: auto;
            transform: scaleX(-1); /* Mirror video */
            border-radius: 8px;
        }
        
        .gesture-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1); /* Mirror canvas to match video */
        }
        
        .target-gesture {
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(79, 70, 229, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0);
            }
        }
        
        #gestureResult {
            transition: all 0.3s ease;
        }
        
        .badge {
            font-size: 0.9rem;
            padding: 0.5rem;
        }
        
        /* AI Dashboard Styles */
        .ai-assistant-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ccc;
            display: inline-block;
        }
        
        .status-indicator.active {
            background-color: #4caf50;
        }
        
        .status-indicator.warning {
            background-color: #ff9800;
        }
        
        .status-indicator.danger {
            background-color: #f44336;
        }
        
        .control-icon, .status-icon, .ai-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-item, .status-item, .ai-insight-item {
            transition: all 0.3s ease;
            border-radius: 8px;
            padding: 8px;
        }
        
        .control-item:hover, .status-item:hover, .ai-insight-item:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        .chart-container {
            position: relative;
            min-height: 180px;
        }
        
        .command-history {
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .command-history::-webkit-scrollbar {
            width: 6px;
        }
        
        .command-history::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .command-history::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .command-history::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .command-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .command-item:last-child {
            border-bottom: none;
        }
        
        .command-icon {
            margin-right: 0.5rem;
            color: #4F46E5;
        }
        
        .command-text {
            flex-grow: 1;
        }
        
        .command-time {
            color: #888;
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        /* Analytics View */
        .analytics-view {
            position: relative;
            padding: 10px;
        }
        
        /* Dark mode adjustments for new elements */
        .dark-mode .control-item:hover, 
        .dark-mode .status-item:hover, 
        .dark-mode .ai-insight-item:hover {
            background-color: rgba(255,255,255,0.05);
        }
        
        .dark-mode .command-item {
            border-color: rgba(255,255,255,0.1);
        }
        
        .dark-mode .status-indicator {
            background-color: #555;
        }
        
        .dark-mode .card.bg-primary {
            background-color: #3730a3 !important;
        }
        
        .dark-mode .command-history::-webkit-scrollbar-track {
            background: #2a2a2a;
        }
        
        .dark-mode .command-history::-webkit-scrollbar-thumb {
            background: #666;
        }
        
        .dark-mode .command-history::-webkit-scrollbar-thumb:hover {
            background: #888;
        }
        
        /* RTL adjustments for new elements */
        html[dir="rtl"] .command-icon {
            margin-right: 0;
            margin-left: 0.5rem;
        }
        
        html[dir="rtl"] .ai-icon.me-2 {
            margin-right: 0 !important;
            margin-left: 0.5rem !important;
        }
    </style>
    <!-- Add Google Fonts for Arabic support -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1 class="text-center my-4">Gesture & Voice Control App</h1>
        
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Home</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="gestures-tab" data-bs-toggle="tab" data-bs-target="#gestures" type="button" role="tab" aria-controls="gestures" aria-selected="false">Gestures</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="voice-tab" data-bs-toggle="tab" data-bs-target="#voice" type="button" role="tab" aria-controls="voice" aria-selected="false">Voice</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="games-tab" data-bs-toggle="tab" data-bs-target="#games" type="button" role="tab" aria-controls="games" aria-selected="false">Games</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="false">Settings</button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- Home Tab -->
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <!-- Welcome Section with AI Assistant -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card border-0 bg-primary text-white shadow">
                            <div class="card-body d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h4 class="mb-1" data-translation-key="welcomeHeader">Welcome to Your AI Control Hub</h4>
                                    <p class="mb-0" data-translation-key="welcomeMessage">Control your device with intelligent gesture and voice recognition.</p>
                                    <div class="mt-3">
                                        <button class="btn btn-light btn-sm me-2" data-translation-key="quickStartButton">Quick Start Guide</button>
                                        <button class="btn btn-outline-light btn-sm" data-translation-key="aiTipsButton">AI Tips</button>
                                    </div>
                                </div>
                                <div class="ms-3 text-center d-none d-md-block">
                                    <div class="ai-assistant-avatar">
                                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
                                            <path d="M12 16v-4"></path>
                                            <path d="M12 8h.01"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Control Panel and Status Dashboard -->
                <div class="row mb-4">
                    <!-- Control Panel -->
                    <div class="col-md-6 mb-4 mb-md-0">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center bg-white">
                                <h5 class="mb-0 fw-bold" data-translation-key="controlPanel">Control Panel</h5>
                                <span class="badge rounded-pill bg-primary" data-translation-key="aiPowered">AI Powered</span>
                            </div>
                            <div class="card-body">
                                <!-- Gesture Control -->
                                <div class="control-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                    <div class="d-flex align-items-center">
                                        <div class="control-icon me-3 text-primary">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M18 8a2 2 0 1 1 4 0v4a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34L3.6 15.24a2 2 0 1 1 2.83-2.82L8 14"></path>
                                                <path d="M15 12V6a2 2 0 1 0-4 0v8"></path>
                                                <path d="M12 14h4"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h6 class="mb-0" data-translation-key="gestureControl">Gesture Control</h6>
                                            <small class="text-muted" data-translation-key="gestureDescription">Control your device with hand movements</small>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="switch">
                                            <input type="checkbox" id="gestureToggle">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="text-warning mb-3 small" id="gestureWarning" data-translation-key="gesturesNotConfigured">Gestures not configured. Visit the Training screen.</div>
                                
                                <!-- Voice Control -->
                                <div class="control-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                    <div class="d-flex align-items-center">
                                        <div class="control-icon me-3 text-primary">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M12 18.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"></path>
                                                <path d="M6.5 12H3"></path>
                                                <path d="M21 12h-3.5"></path>
                                                <path d="M4.5 16.5h3"></path>
                                                <path d="M16.5 16.5h3"></path>
                                                <path d="M19.5 7.5h-3"></path>
                                                <path d="M4.5 7.5h3"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h6 class="mb-0" data-translation-key="voiceControl">Voice Control</h6>
                                            <small class="text-muted" data-translation-key="voiceDescription">Control with voice commands</small>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="switch">
                                            <input type="checkbox" id="voiceToggle">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="text-warning mb-3 small" id="voiceWarning" data-translation-key="voiceNotEnrolled">Voice not enrolled. Visit the Voice Enrollment screen.</div>
                                
                                <!-- Background Mode -->
                                <div class="control-item d-flex justify-content-between align-items-center mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="control-icon me-3 text-primary">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <rect width="18" height="18" x="3" y="3" rx="2"></rect>
                                                <path d="M7 7h.01"></path>
                                                <path d="M17 7h.01"></path>
                                                <path d="M7 17h.01"></path>
                                                <path d="M17 17h.01"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h6 class="mb-0" data-translation-key="backgroundMode">Background Mode</h6>
                                            <small class="text-muted" data-translation-key="backgroundModeDescription">Keep detection active when minimized</small>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="switch">
                                            <input type="checkbox" id="backgroundModeToggle">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="text-info small" id="backgroundModeHelp" data-translation-key="backgroundModeHelp">When enabled, gestures work even when the app is minimized.</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status Dashboard -->
                    <div class="col-md-6">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header d-flex justify-content-between align-items-center bg-white">
                                <h5 class="mb-0 fw-bold" data-translation-key="statusDashboard">Status Dashboard</h5>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary active" data-view="status" data-translation-key="statusView">Status</button>
                                    <button type="button" class="btn btn-outline-primary" data-view="analytics" data-translation-key="analyticsView">Analytics</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Status View -->
                                <div id="statusView" class="status-view">
                                    <div class="status-item d-flex align-items-center mb-3 pb-3 border-bottom">
                                        <div class="status-icon me-3">
                                            <div class="status-indicator" id="gestureIndicator"></div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between">
                                                <span data-translation-key="gestureControlStatus">Gesture Control:</span>
                                                <span id="gestureStatus" class="text-secondary" data-translation-key="inactive">Inactive</span>
                                            </div>
                                            <div class="progress mt-1" style="height: 5px;">
                                                <div class="progress-bar" id="gestureProgress" role="progressbar" style="width: 0%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="status-item d-flex align-items-center mb-3 pb-3 border-bottom">
                                        <div class="status-icon me-3">
                                            <div class="status-indicator" id="voiceIndicator"></div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between">
                                                <span data-translation-key="voiceControlStatus">Voice Control:</span>
                                                <span id="voiceStatus" class="text-secondary" data-translation-key="inactive">Inactive</span>
                                            </div>
                                            <div class="progress mt-1" style="height: 5px;">
                                                <div class="progress-bar" id="voiceProgress" role="progressbar" style="width: 0%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="status-item d-flex align-items-center mb-3 pb-3 border-bottom">
                                        <div class="status-icon me-3">
                                            <div class="status-indicator" id="gestureConfigIndicator"></div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between">
                                                <span data-translation-key="gesturesConfigured">Gestures Configured:</span>
                                                <span id="gestureConfigStatus" class="text-danger" data-translation-key="no">No</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="status-item d-flex align-items-center mb-3 pb-3 border-bottom">
                                        <div class="status-icon me-3">
                                            <div class="status-indicator" id="voiceEnrollIndicator"></div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between">
                                                <span data-translation-key="voiceEnrolled">Voice Enrolled:</span>
                                                <span id="voiceEnrollStatus" class="text-danger" data-translation-key="no">No</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="status-item d-flex align-items-center">
                                        <div class="status-icon me-3">
                                            <div class="status-indicator" id="backgroundModeIndicator"></div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between">
                                                <span data-translation-key="backgroundModeStatus">Background Mode:</span>
                                                <span id="backgroundModeStatus" class="text-secondary" data-translation-key="inactive">Inactive</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Analytics View (Hidden by default) -->
                                <div id="analyticsView" class="analytics-view d-none">
                                    <div class="text-center mb-3" data-translation-key="usageAnalytics">Usage Analytics</div>
                                    <div class="chart-container mb-3" style="height: 180px;">
                                        <canvas id="usageChart"></canvas>
                                    </div>
                                    <div class="text-center small text-muted mb-3" data-translation-key="aiInsight">AI Insight: Your most used gestures are Thumbs Up and Point Up</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Insights and Recent Commands -->
                <div class="row">
                    <!-- AI Gesture Insights -->
                    <div class="col-md-6 mb-4 mb-md-0">
                        <div class="card shadow-sm h-100">
                            <div class="card-header d-flex justify-content-between align-items-center bg-white">
                                <h5 class="mb-0 fw-bold" data-translation-key="aiInsights">AI Insights</h5>
                                <button class="btn btn-sm btn-outline-primary" data-translation-key="refreshButton">Refresh</button>
                            </div>
                            <div class="card-body">
                                <div class="ai-insights-container">
                                    <!-- AI Insight Item -->
                                    <div class="ai-insight-item mb-3 pb-3 border-bottom">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="ai-icon text-primary me-2">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M12 2v8"></path>
                                                    <path d="m4.93 10.93 1.41 1.41"></path>
                                                    <path d="M2 18h2"></path>
                                                    <path d="M20 18h2"></path>
                                                    <path d="m19.07 10.93-1.41 1.41"></path>
                                                    <path d="M22 22H2"></path>
                                                    <path d="m16 8-4 4-4-4"></path>
                                                    <path d="M16 16a4 4 0 0 0-8 0"></path>
                                                </svg>
                                            </div>
                                            <h6 class="mb-0" data-translation-key="gesturePatterns">Gesture Patterns</h6>
                                        </div>
                                        <p class="mb-0 small" data-translation-key="gesturePatternInsight">You frequently use Palm → Thumbs Up in sequence. Set up a custom gesture combination for enhanced productivity.</p>
                                    </div>
                                    
                                    <!-- AI Insight Item -->
                                    <div class="ai-insight-item mb-3 pb-3 border-bottom">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="ai-icon text-primary me-2">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M2 12h10"></path>
                                                    <path d="M9 4v16"></path>
                                                    <path d="M14 9h3"></path>
                                                    <path d="M17 6v6"></path>
                                                    <path d="M22 11c0 .7-.13 1.37-.35 2"></path>
                                                    <path d="M22 4c0 5-4.5 7-4.5 9"></path>
                                                    <path d="M15 22v-6c0-2 1-3 3-3"></path>
                                                </svg>
                                            </div>
                                            <h6 class="mb-0" data-translation-key="suggestionTitle">Suggested Training</h6>
                                        </div>
                                        <p class="mb-0 small" data-translation-key="trainingInsight">Based on your usage, training the "Point Down" gesture would improve your workflow. <a href="#" data-translation-key="trainNowLink">Train now</a></p>
                                    </div>
                                    
                                    <!-- AI Insight Item -->
                                    <div class="ai-insight-item">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="ai-icon text-primary me-2">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M5 3a2 2 0 0 0-2 2"></path>
                                                    <path d="M19 3a2 2 0 0 1 2 2"></path>
                                                    <path d="M21 19a2 2 0 0 1-2 2"></path>
                                                    <path d="M5 21a2 2 0 0 1-2-2"></path>
                                                    <path d="M9 3h1"></path>
                                                    <path d="M9 21h1"></path>
                                                    <path d="M14 3h1"></path>
                                                    <path d="M14 21h1"></path>
                                                    <path d="M3 9v1"></path>
                                                    <path d="M21 9v1"></path>
                                                    <path d="M3 14v1"></path>
                                                    <path d="M21 14v1"></path>
                                                    <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0-6 0"></path>
                                                </svg>
                                            </div>
                                            <h6 class="mb-0" data-translation-key="voiceAccuracy">Voice Accuracy</h6>
                                        </div>
                                        <p class="mb-0 small" data-translation-key="voiceAccuracyInsight">Voice recognition accuracy is at 85%. Try re-enrolling in a quieter environment for improved results.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Commands -->
                    <div class="col-md-6">
                        <div class="card shadow-sm h-100">
                            <div class="card-header d-flex justify-content-between align-items-center bg-white">
                                <h5 class="mb-0 fw-bold" data-translation-key="recentCommands">Recent Commands</h5>
                                <span class="badge bg-primary" id="commandCount">0</span>
                            </div>
                            <div class="card-body">
                                <div id="noCommands" class="text-center py-4 text-secondary" data-translation-key="noCommands">No commands executed yet</div>
                                <div id="commandHistory" class="command-history d-none">
                                    <!-- Command history will be populated by JavaScript -->
                                </div>
                                
                                <!-- AI Command Suggestions -->
                                <div class="mt-3 pt-3 border-top d-flex flex-column">
                                    <div class="small fw-bold mb-2" data-translation-key="aiSuggested">AI Suggested Actions</div>
                                    <div class="d-flex flex-wrap gap-2">
                                        <button class="btn btn-sm btn-outline-primary" data-translation-key="openCameraAction">Open Camera</button>
                                        <button class="btn btn-sm btn-outline-primary" data-translation-key="takePhotoAction">Take Photo</button>
                                        <button class="btn btn-sm btn-outline-primary" data-translation-key="navigateBackAction">Navigate Back</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gestures Tab -->
            <div class="tab-pane fade" id="gestures" role="tabpanel" aria-labelledby="gestures-tab">
                <p class="mb-4">Train your device to recognize your custom gestures. Each gesture requires 3 training steps.</p>
                
                <!-- Gesture Detector Component -->
                <div class="card mb-4">
                    <div class="card-header">Gesture Detection</div>
                    <div class="card-body">
                        <div id="gestureDetector" class="gesture-detector">
                            <div class="loading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Initializing gesture detection...</p>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-center mt-3">
                            <button class="btn btn-primary me-2" id="startGestureBtn">Start Detection</button>
                            <button class="btn btn-danger" id="stopGestureBtn" disabled>Stop Detection</button>
                        </div>
                        
                        <div id="detectedGestureInfo" class="alert alert-info mt-3 d-none">
                            <strong>Last Detected:</strong> <span id="lastGestureName">None</span>
                            <br>
                            <strong>Action:</strong> <span id="lastGestureAction">None</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span data-translation-key="availableGestures">Available Gestures</span>
                        <span class="badge rounded-pill bg-secondary" data-translation-key="gesturesCount">8 Gestures</span>
                    </div>
                    <div class="card-body">
                        <!-- Basic gestures category -->
                        <div class="gesture-category mb-4">
                            <h5 class="text-primary mb-3" data-translation-key="basicGestures">Basic Gestures</h5>
                            
                            <div class="gesture-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="gesture-icon">
                                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                                            <path d="M20 14c1 0 2-.5 2-2V6c0-1.5-1-2-2-2H4C2.5 4 2 5 2 6v6c0 1.5 1 2 2 2"></path>
                                            <path d="m14 14-3-3 9-9"></path>
                                            <path d="M14 22 7 15l-1 1v4c0 1.5 1 2 2 2Z"></path>
                                        </svg>
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold" data-translation-key="swipeRightGesture">Swipe Right</div>
                                        <div class="text-muted small" data-translation-key="swipeRightDescription">Navigate to next screen</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-1" data-translation-key="trainButton">Train</button>
                                    <span class="badge bg-secondary" data-translation-key="untrained">Untrained</span>
                                </div>
                            </div>
                            
                            <div class="gesture-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="gesture-icon">
                                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                                            <path d="M4 14c-1 0-2-.5-2-2V6c0-1.5 1-2 2-2h16c1.5 0 2 1 2 2v6c0 1.5-1 2-2 2"></path>
                                            <path d="m10 14 3-3-9-9"></path>
                                            <path d="M10 22l7-7 1 1v4c0 1.5-1 2-2 2Z"></path>
                                        </svg>
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold" data-translation-key="swipeLeftGesture">Swipe Left</div>
                                        <div class="text-muted small" data-translation-key="swipeLeftDescription">Navigate to previous screen</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-1" data-translation-key="trainButton">Train</button>
                                    <span class="badge bg-secondary" data-translation-key="untrained">Untrained</span>
                                </div>
                            </div>
                            
                            <div class="gesture-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="gesture-icon">
                                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                                            <path d="M7 11v8a1 1 0 0 0 1 1h8"></path>
                                            <path d="M14 10V4a1 1 0 0 0-1-1v0a1 1 0 0 0-1 1v1"></path>
                                            <path d="M12 4a1 1 0 0 0-1-1h0a1 1 0 0 0-1 1v3"></path>
                                            <path d="M10 5a1 1 0 0 0-1-1h0a1 1 0 0 0-1 1v3"></path>
                                            <path d="M19 10h1a2 2 0 0 1 2 2v0c0 1.1-.9 2-2 2"></path>
                                            <path d="M22 14a2 2 0 0 1-2 2h-1"></path>
                                            <path d="M14 14a2 2 0 0 1 2 2v4"></path>
                                            <path d="M14 20h-4"></path>
                                            <path d="M4 10a2 2 0 0 1 2-2h1"></path>
                                            <path d="M9 10h5"></path>
                                            <path d="M16 10h0"></path>
                                        </svg>
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold" data-translation-key="thumbsUpGesture">Thumbs Up</div>
                                        <div class="text-muted small" data-translation-key="thumbsUpDescription">Confirm or take photo</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-1" data-translation-key="trainButton">Train</button>
                                    <span class="badge bg-secondary" data-translation-key="untrained">Untrained</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Advanced Gestures Category -->
                        <div class="gesture-category mb-4">
                            <h5 class="text-primary mb-3" data-translation-key="advancedGestures">Advanced Gestures</h5>
                            
                            <div class="gesture-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="gesture-icon">
                                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-success">
                                            <path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"></path>
                                            <path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"></path>
                                            <path d="M10 10V5a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v10"></path>
                                            <path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path>
                                        </svg>
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold" data-translation-key="palmGesture">Palm</div>
                                        <div class="text-muted small" data-translation-key="palmDescription">Open camera or pause function</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-1" data-translation-key="retrainButton">Retrain</button>
                                    <button class="btn btn-outline-danger btn-sm" data-translation-key="deleteButton">Delete</button>
                                    <span class="badge bg-success ms-1" data-translation-key="trained">Trained</span>
                                </div>
                            </div>
                            
                            <div class="gesture-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="gesture-icon">
                                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-success">
                                            <path d="M12 22a4 4 0 0 0 4-4v-8.5a2.5 2.5 0 0 0-5 0V14"></path>
                                            <path d="M9 14h6"></path>
                                            <path d="M12 22a4 4 0 0 1-4-4v-8.5a2.5 2.5 0 0 1 5 0"></path>
                                        </svg>
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold" data-translation-key="pinchGesture">Pinch</div>
                                        <div class="text-muted small" data-translation-key="pinchDescription">Zoom or decrease brightness</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-1" data-translation-key="retrainButton">Retrain</button>
                                    <button class="btn btn-outline-danger btn-sm" data-translation-key="deleteButton">Delete</button>
                                    <span class="badge bg-success ms-1" data-translation-key="trained">Trained</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Special Function Gestures -->
                        <div class="gesture-category mb-4">
                            <h5 class="text-primary mb-3" data-translation-key="specialFunctionGestures">Special Function Gestures</h5>
                            
                            <div class="gesture-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="gesture-icon">
                                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-info">
                                            <path d="M12 14v7"></path>
                                            <path d="M10 3v4c0 1.1.9 2 2 2s2-.9 2-2V3"></path>
                                            <path d="M14 21h-4"></path>
                                            <path d="M14 3h-4"></path>
                                        </svg>
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold" data-translation-key="pointUpGesture">Point Up</div>
                                        <div class="text-muted small" data-translation-key="pointUpDescription">Flip video vertically</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-1" data-translation-key="trainButton">Train</button>
                                    <span class="badge bg-info" data-translation-key="specialFunction">Special Function</span>
                                </div>
                            </div>
                            
                            <div class="gesture-item d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="gesture-icon">
                                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-info">
                                            <path d="M12 10v7"></path>
                                            <path d="M12 17l-2 2"></path>
                                            <path d="M12 17l2 2"></path>
                                            <path d="M10 10H9a4 4 0 0 0-4 4c0 .69.28 1.36.78 1.86l.78.78"></path>
                                            <path d="M20 10h-8V7a2 2 0 1 0-4 0v3"></path>
                                        </svg>
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold" data-translation-key="pointDownGesture">Point Down</div>
                                        <div class="text-muted small" data-translation-key="pointDownDescription">Flip video horizontally</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-1" data-translation-key="trainButton">Train</button>
                                    <span class="badge bg-info" data-translation-key="specialFunction">Special Function</span>
                                </div>
                            </div>
                            
                            <div class="gesture-item d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="gesture-icon">
                                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-warning">
                                            <path d="M12 19c.6-1.7 1.4-2.3 3-2.7"></path>
                                            <path d="M12 13.5V19"></path>
                                            <path d="M15 13.5h-6"></path>
                                            <path d="M20 6 9 17l-5-5"></path>
                                        </svg>
                                    </div>
                                    <div class="ms-3">
                                        <div class="fw-bold" data-translation-key="victoryGesture">Victory</div>
                                        <div class="text-muted small" data-translation-key="victoryDescription">Customizable action</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-1" id="customGestureBtn" data-translation-key="configureButton">Configure</button>
                                    <span class="badge bg-warning" data-translation-key="customAction">Custom Action</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Custom Gesture Modal -->
                        <div class="modal fade" id="customGestureModal" tabindex="-1" aria-labelledby="customGestureModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="customGestureModalLabel">Configure Custom Gesture</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <label for="customGestureName" class="form-label">Gesture Name</label>
                                            <input type="text" class="form-control" id="customGestureName" value="Victory" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label for="customActionType" class="form-label">Action Type</label>
                                            <select class="form-select" id="customActionType">
                                                <option value="open_url">Open URL</option>
                                                <option value="open_app">Launch Application</option>
                                                <option value="keyboard_shortcut">Keyboard Shortcut</option>
                                                <option value="custom_command">Custom Command</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="customActionValue" class="form-label">Action Value</label>
                                            <input type="text" class="form-control" id="customActionValue" placeholder="Enter URL, app name, shortcut, or command">
                                            <div class="form-text" id="customActionHelp">Example: https://example.com for a URL or "Calculator" for an app</div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-primary" id="saveCustomGesture">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Voice Tab -->
            <div class="tab-pane fade" id="voice" role="tabpanel" aria-labelledby="voice-tab">
                <p class="mb-4">Enroll your voice to enable secure voice commands. You'll need to record yourself saying 3 different phrases.</p>
                
                <div class="card">
                    <div class="card-header">Enrollment Status</div>
                    <div class="card-body">
                        <div id="voiceNotEnrolled">
                            <div class="progress">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: 0%"></div>
                            </div>
                            <div class="text-secondary text-end mb-3">Step 0 of 3</div>
                            
                            <div class="text-center mb-3">
                                <h5>Ready to start</h5>
                            </div>
                            
                            <div class="d-grid">
                                <button class="btn btn-primary" id="startRecording">Start Recording</button>
                            </div>
                        </div>
                        
                        <div id="voiceEnrolled" class="d-none text-center">
                            <div class="bg-success text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; font-size: 40px;">✓</div>
                            <p class="mb-3">Your voice is successfully enrolled. You can now use voice commands.</p>
                            <button class="btn btn-outline-danger">Clear Enrollment</button>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">About Voice Enrollment</div>
                    <div class="card-body">
                        <p>Voice enrollment creates a unique voice profile that helps authenticate your voice commands.</p>
                        <p>Benefits:</p>
                        <ul>
                            <li>Enhanced security for voice commands</li>
                            <li>Prevents others from using voice commands on your device</li>
                            <li>Improves voice recognition accuracy</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Games Tab -->
            <div class="tab-pane fade" id="games" role="tabpanel" aria-labelledby="games-tab">
                <div class="row mb-4">
                    <div class="col-12">
                        <ul class="nav nav-pills mb-4" id="gamesTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="gesture-master-tab" data-bs-toggle="pill" data-bs-target="#gesture-master" type="button" role="tab" aria-controls="gesture-master" aria-selected="true">Gesture Master</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="football-trivia-tab" data-bs-toggle="pill" data-bs-target="#football-trivia" type="button" role="tab" aria-controls="football-trivia" aria-selected="false">Football Trivia</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="gamesTabContent">
                            <div class="tab-pane fade show active" id="gesture-master" role="tabpanel" aria-labelledby="gesture-master-tab">
                                <h3 class="mb-3">Gesture Master</h3>
                                <p id="gestureMasterDescription">Test your gesture skills in this fun game! Match the shown gesture as quickly as possible to score points.</p>
                            </div>
                            
                            <div class="tab-pane fade" id="football-trivia" role="tabpanel" aria-labelledby="football-trivia-tab">
                                <h3 class="mb-3">Football Trivia</h3>
                                <p id="footballTriviaDescription">Test your football knowledge! Answer trivia questions using gestures - thumbs up for True, thumbs down for False.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gesture Master Game Content -->
                <div id="gesture-master-content">
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span id="gameControlsHeader">Game Controls</span>
                            <div>
                                <span class="badge bg-primary me-2"><span class="scoreLabel">Score:</span> <span id="gameScore">0</span></span>
                                <span class="badge bg-info"><span class="timeLabel">Time:</span> <span id="gameTimer">60</span>s</span>
                            </div>
                        </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div id="gameGestureDetector" class="gesture-detector mb-3">
                                    <div class="loading">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2">Initializing game...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header" id="matchGestureHeader">Match This Gesture:</div>
                                    <div class="card-body text-center">
                                        <div id="targetGesture" class="target-gesture mb-3">
                                            <div class="gesture-icon" style="font-size: 4rem;">👍</div>
                                            <h4>Thumbs Up</h4>
                                        </div>
                                        <div id="gestureResult" class="d-none mt-3"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-center mt-4">
                            <button class="btn btn-success btn-lg me-2 startGameBtn" id="startGameBtn">Start Game</button>
                            <button class="btn btn-danger btn-lg endGameBtn" id="stopGameBtn" disabled>End Game</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header highScoresHeader">High Scores</div>
                    <div class="card-body">
                        <table class="table table-striped" id="highScoresTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Score</th>
                                    <th>Date</th>
                                    <th>Gestures Matched</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="noScoresRow">
                                    <td colspan="4" class="text-center noScoresMessage">No high scores yet. Play a game to set your first score!</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
                
                <!-- Football Trivia Game Content -->
                <div id="football-trivia-content" style="display: none;">
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Football Trivia</span>
                            <div>
                                <span class="badge bg-primary me-2">Score: <span id="triviaScore">0</span></span>
                                <span class="badge bg-success me-2">Correct: <span id="correctAnswers">0</span></span>
                                <span class="badge bg-danger">Questions: <span id="questionNumber">0</span>/10</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div id="triviaGestureDetector" class="gesture-detector mb-3">
                                        <div class="loading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Initializing trivia game...</p>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-around mt-3 mb-3">
                                        <div class="text-center">
                                            <div class="gesture-icon" style="font-size: 2rem;">👍</div>
                                            <div class="trueLabel">True</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="gesture-icon" style="font-size: 2rem;">👎</div>
                                            <div class="falseLabel">False</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header" id="footballQuestionHeader">Football Question:</div>
                                        <div class="card-body">
                                            <div id="questionContainer" class="mb-3 p-3 bg-light rounded">
                                                <h5 id="triviaQuestion">Press Start to begin the Football Trivia!</h5>
                                            </div>
                                            <div id="answerResult" class="mt-3 d-none"></div>
                                            <div id="triviaExplanation" class="mt-3 d-none small text-muted"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center mt-4">
                                <button class="btn btn-success btn-lg me-2 startTriviaBtn" id="startTriviaBtn">Start Trivia</button>
                                <button class="btn btn-danger btn-lg endTriviaBtn" id="stopTriviaBtn" disabled>End Trivia</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header highScoresHeader">Trivia High Scores</div>
                        <div class="card-body">
                            <table class="table table-striped" id="triviaScoresTable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Score</th>
                                        <th>Date</th>
                                        <th>Correct Answers</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr id="noTriviaScoresRow">
                                        <td colspan="4" class="text-center noTriviaScoresMessage">No trivia scores yet. Play the game to set your first score!</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                <div class="card mb-4">
                    <div class="card-header">Appearance</div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>Dark Mode</div>
                            <label class="switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">Language</div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>Select Language</div>
                            <div>
                                <select id="languageSelector" class="form-select">
                                    <option value="en">English</option>
                                    <option value="ar">العربية</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">Accessibility</div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>Text Size</div>
                            <div>
                                <button class="btn btn-primary btn-sm me-2">A-</button>
                                <button class="btn btn-primary btn-sm">A+</button>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <div>High Contrast</div>
                            <label class="switch">
                                <input type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">About</div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>Version</div>
                            <div class="text-secondary">1.0.0</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">Data Management</div>
                    <div class="card-body">
                        <button class="btn btn-outline-danger w-100 mb-2">Reset App Data</button>
                        <small class="text-secondary">This will delete all gestures, voice enrollments, and reset all settings.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Add fingerpose library -->
    <script src="https://cdn.jsdelivr.net/npm/fingerpose@0.1.0/dist/fingerpose.min.js"></script>
    <!-- Background Service for continuous gesture detection -->
    <script src="backgroundService.js"></script>
    
    <script>
        // Demo functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Dark mode toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            darkModeToggle.addEventListener('change', function() {
                document.body.classList.toggle('dark-mode', this.checked);
            });
            
            // Gesture control toggle
            const gestureToggle = document.getElementById('gestureToggle');
            gestureToggle.addEventListener('change', function() {
                document.getElementById('gestureStatus').textContent = this.checked ? 'Active' : 'Inactive';
                document.getElementById('gestureStatus').className = this.checked ? 'text-success' : 'text-secondary';
                
                if (this.checked) {
                    startGestureDetection();
                    
                    // Also start background service if background mode is active
                    if (backgroundModeToggle.checked && window.backgroundGestureService) {
                        window.backgroundGestureService.start(function(gestureName) {
                            const action = gestureToAction[gestureName] || 'UNKNOWN_ACTION';
                            console.log('Background gesture detected:', gestureName, '→', action);
                            executeAction(action);
                        });
                    }
                } else {
                    stopGestureDetection();
                    
                    // Also stop background service
                    if (window.backgroundGestureService) {
                        window.backgroundGestureService.stop();
                    }
                }
            });
            
            // Voice control toggle
            const voiceToggle = document.getElementById('voiceToggle');
            voiceToggle.addEventListener('change', function() {
                document.getElementById('voiceStatus').textContent = this.checked ? 'Active' : 'Inactive';
                document.getElementById('voiceStatus').className = this.checked ? 'text-success' : 'text-secondary';
            });
            
            // Background mode toggle
            const backgroundModeToggle = document.getElementById('backgroundModeToggle');
            backgroundModeToggle.addEventListener('change', function() {
                document.getElementById('backgroundModeStatus').textContent = this.checked ? 'Active' : 'Inactive';
                document.getElementById('backgroundModeStatus').className = this.checked ? 'text-success' : 'text-secondary';
                
                if (this.checked) {
                    // Start background gesture detection
                    if (window.backgroundGestureService) {
                        window.backgroundGestureService.start(function(gestureName) {
                            // Handle detected gesture
                            const action = gestureToAction[gestureName] || 'UNKNOWN_ACTION';
                            console.log('Background gesture detected:', gestureName, '→', action);
                            executeAction(action);
                            addCommand(action);
                        });
                    }
                } else {
                    // Stop background gesture detection
                    if (window.backgroundGestureService) {
                        window.backgroundGestureService.stop();
                    }
                }
            });
            
            // Configure gesture recognition
            const configureGesture = function() {
                document.getElementById('gestureConfigStatus').textContent = 'Yes';
                document.getElementById('gestureConfigStatus').className = 'text-success';
                document.getElementById('gestureWarning').style.display = 'none';
                gestureToggle.disabled = false;
            };
            
            // Simulate voice enrollment
            const enrollVoice = function() {
                document.getElementById('voiceEnrollStatus').textContent = 'Yes';
                document.getElementById('voiceEnrollStatus').className = 'text-success';
                document.getElementById('voiceWarning').style.display = 'none';
                document.getElementById('voiceNotEnrolled').classList.add('d-none');
                document.getElementById('voiceEnrolled').classList.remove('d-none');
                voiceToggle.disabled = false;
            };
            
            // Initial setup
            gestureToggle.disabled = true;
            voiceToggle.disabled = true;
            backgroundModeToggle.disabled = false;
            
            // Simulate recording
            const startRecordingBtn = document.getElementById('startRecording');
            startRecordingBtn.addEventListener('click', function() {
                const progressBar = document.querySelector('.progress-bar');
                let step = 0;
                
                const advanceProgress = function() {
                    step++;
                    const progress = (step / 3) * 100;
                    progressBar.style.width = progress + '%';
                    document.querySelector('.text-secondary.text-end').textContent = `Step ${step} of 3`;
                    
                    if (step === 1) {
                        startRecordingBtn.textContent = 'Recording...';
                        startRecordingBtn.classList.add('btn-success');
                        document.querySelector('h5').textContent = 'Please say: "My voice is my passport"';
                    } else if (step === 2) {
                        document.querySelector('h5').textContent = 'Please say: "Verify me"';
                    } else if (step === 3) {
                        document.querySelector('h5').textContent = 'Please say: "Access granted"';
                        startRecordingBtn.textContent = 'Finish Enrollment';
                        startRecordingBtn.addEventListener('click', enrollVoice, { once: true });
                    }
                };
                
                // Simulate recording steps
                advanceProgress();
                startRecordingBtn.removeEventListener('click', arguments.callee);
                startRecordingBtn.addEventListener('click', advanceProgress);
            });
            
            // Command history
            const commands = [
                { action: 'OPEN_CAMERA', timestamp: '10:23 AM' },
                { action: 'TAKE_PHOTO', timestamp: '10:24 AM' },
                { action: 'GO_BACK', timestamp: '10:25 AM' }
            ];
            
            const showCommands = function() {
                document.getElementById('noCommands').classList.add('d-none');
                const commandHistory = document.getElementById('commandHistory');
                commandHistory.classList.remove('d-none');
                commandHistory.innerHTML = '';
                
                commands.forEach(command => {
                    const div = document.createElement('div');
                    div.className = 'd-flex justify-content-between mb-2 pb-2 border-bottom';
                    div.innerHTML = `
                        <div>${command.action.replace(/_/g, ' ')}</div>
                        <div class="text-secondary">${command.timestamp}</div>
                    `;
                    commandHistory.appendChild(div);
                });
            };
            
            // Add a command after 3 seconds for demo
            setTimeout(() => {
                configureGesture();
                showCommands();
                
                // Initialize the background service
                if (window.backgroundGestureService) {
                    console.log('Initializing background gesture service...');
                    window.backgroundGestureService.initialize().then(success => {
                        console.log('Background service initialized:', success ? 'successfully' : 'failed');
                    });
                }
            }, 3000);
            
            // Add command to history
            const addCommand = function(action) {
                const now = new Date();
                const timestamp = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                commands.unshift({ action, timestamp });
                
                if (commands.length > 10) {
                    commands.pop(); // Keep only the last 10 commands
                }
                
                showCommands();
            };
            
            // ============ Gesture Detection Implementation ============
            // Global variables
            let handposeModel = null;
            let gestureEstimator = null;
            let videoStream = null;
            let videoElement = null;
            let canvasElement = null;
            let detecting = false;
            let detectionInterval = null;
            
            // Initialization
            const initTensorFlow = async () => {
                try {
                    console.log('Initializing TensorFlow.js...');
                    await tf.ready();
                    console.log('TensorFlow.js is ready');
                    
                    // Load handpose model
                    console.log('Loading handpose model...');
                    handposeModel = await handpose.load();
                    console.log('Handpose model loaded successfully');
                    
                    // Initialize gesture estimator
                    await initializeGestureEstimator();
                    
                    return true;
                } catch (error) {
                    console.error('Error initializing TensorFlow:', error);
                    return false;
                }
            };
            
            // Initialize gesture estimator with defined gestures
            const initializeGestureEstimator = async () => {
                const fp = window.fp;
                if (!fp) {
                    console.error('Fingerpose library not loaded');
                    return;
                }
                
                // Define default gestures
                const thumbsUpGesture = new fp.GestureDescription('thumbs_up');
                thumbsUpGesture.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
                thumbsUpGesture.addDirection(fp.Finger.Thumb, fp.FingerDirection.VerticalUp, 1.0);
                thumbsUpGesture.addCurl(fp.Finger.Index, fp.FingerCurl.FullCurl, 1.0);
                thumbsUpGesture.addCurl(fp.Finger.Middle, fp.FingerCurl.FullCurl, 1.0);
                thumbsUpGesture.addCurl(fp.Finger.Ring, fp.FingerCurl.FullCurl, 1.0);
                thumbsUpGesture.addCurl(fp.Finger.Pinky, fp.FingerCurl.FullCurl, 1.0);
                
                // Define palm gesture
                const palmGesture = new fp.GestureDescription('palm');
                palmGesture.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
                palmGesture.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
                palmGesture.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
                palmGesture.addCurl(fp.Finger.Ring, fp.FingerCurl.NoCurl, 1.0);
                palmGesture.addCurl(fp.Finger.Pinky, fp.FingerCurl.NoCurl, 1.0);

                // Define pinch gesture
                const pinchGesture = new fp.GestureDescription('pinch');
                pinchGesture.addCurl(fp.Finger.Index, fp.FingerCurl.HalfCurl, 0.8);
                pinchGesture.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 0.8);
                pinchGesture.addDirection(fp.Finger.Thumb, fp.FingerDirection.DiagonalUpRight, 1.0);
                pinchGesture.addDirection(fp.Finger.Index, fp.FingerDirection.DiagonalUpLeft, 1.0);
                
                // Initialize with defined gestures
                gestureEstimator = new fp.GestureEstimator([
                    thumbsUpGesture,
                    palmGesture,
                    pinchGesture
                ]);
            };
            
            // Start gesture detection
            const startGestureDetection = async () => {
                const gestureDetectorElement = document.getElementById('gestureDetector');
                if (!gestureDetectorElement) return;
                
                // Reset the UI
                gestureDetectorElement.innerHTML = `
                    <div class="loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Initializing gesture detection...</p>
                    </div>
                `;
                
                try {
                    // Initialize TensorFlow if not already done
                    if (!handposeModel) {
                        await initTensorFlow();
                    }
                    
                    // Set up video and canvas
                    videoElement = document.createElement('video');
                    videoElement.className = 'camera-feed';
                    videoElement.width = 320;
                    videoElement.height = 240;
                    videoElement.autoplay = true;
                    videoElement.playsInline = true;
                    videoElement.muted = true;
                    
                    canvasElement = document.createElement('canvas');
                    canvasElement.className = 'gesture-overlay';
                    canvasElement.width = 320;
                    canvasElement.height = 240;
                    
                    // Access camera
                    videoStream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            width: 640,
                            height: 480,
                            facingMode: 'user'
                        }
                    });
                    
                    videoElement.srcObject = videoStream;
                    videoElement.onloadedmetadata = () => {
                        videoElement.play();
                    };
                    
                    // Create video container
                    const videoContainer = document.createElement('div');
                    videoContainer.className = 'video-container';
                    videoContainer.appendChild(videoElement);
                    videoContainer.appendChild(canvasElement);
                    
                    // Create gesture indicator
                    const gestureIndicator = document.createElement('div');
                    gestureIndicator.className = 'gesture-indicator';
                    gestureIndicator.innerHTML = `
                        <span class="badge bg-primary">Ready to detect gestures</span>
                    `;
                    
                    // Clear loading and add elements
                    gestureDetectorElement.innerHTML = '';
                    gestureDetectorElement.appendChild(videoContainer);
                    gestureDetectorElement.appendChild(gestureIndicator);
                    
                    // Show gesture info section
                    document.getElementById('detectedGestureInfo').classList.remove('d-none');
                    
                    // Update button states
                    document.getElementById('startGestureBtn').disabled = true;
                    document.getElementById('stopGestureBtn').disabled = false;
                    
                    // Start detection loop
                    detecting = true;
                    detectGestures();
                    
                } catch (error) {
                    console.error('Error starting gesture detection:', error);
                    gestureDetectorElement.innerHTML = `
                        <div class="alert alert-danger" role="alert">
                            Failed to initialize gesture detection: ${error.message}
                        </div>
                    `;
                }
            };
            
            // Stop gesture detection
            const stopGestureDetection = () => {
                detecting = false;
                
                if (detectionInterval) {
                    clearInterval(detectionInterval);
                    detectionInterval = null;
                }
                
                if (videoStream) {
                    videoStream.getTracks().forEach(track => track.stop());
                    videoStream = null;
                }
                
                // Reset UI
                document.getElementById('gestureDetector').innerHTML = `
                    <div class="text-center p-4">
                        <p>Gesture detection is turned off.</p>
                        <p>To enable, turn on Gesture Control in the Home tab or click Start Detection.</p>
                    </div>
                `;
                
                // Hide gesture info section
                document.getElementById('detectedGestureInfo').classList.add('d-none');
                
                // Update button states
                document.getElementById('startGestureBtn').disabled = false;
                document.getElementById('stopGestureBtn').disabled = true;
            };
            
            // Map gestures to actions
            const gestureToAction = {
                'thumbs_up': 'TAKE_PHOTO',
                'palm': 'OPEN_CAMERA',
                'pinch': 'DECREASE_BRIGHTNESS',
                'point_up': 'FLIP_VIDEO_UP',
                'point_down': 'FLIP_VIDEO_DOWN'
            };
            
            // Execute action based on detected gesture
            const executeAction = (action) => {
                console.log(`Executing action: ${action}`);
                
                // Add to command history
                addCommand(action);
                
                // Update display info
                document.getElementById('lastGestureName').textContent = 
                    Object.entries(gestureToAction).find(([k, v]) => v === action)?.[0].replace('_', ' ') || 'Unknown';
                document.getElementById('lastGestureAction').textContent = action.replace('_', ' ');
                
                // Handle video flipping actions
                if (action === 'FLIP_VIDEO_UP' || action === 'FLIP_VIDEO_DOWN') {
                    flipVideo(action);
                }
                
                // Highlight the detected gesture in the UI
                return { success: true, message: `${action} executed` };
            };
            
            // Flip video based on detected gesture
            const flipVideo = (action) => {
                if (!videoElement) return;
                
                // Get current transform
                let currentTransform = videoElement.style.transform || '';
                
                if (action === 'FLIP_VIDEO_UP') {
                    // Add or toggle vertical flip
                    if (currentTransform.includes('scaleY(-1)')) {
                        currentTransform = currentTransform.replace('scaleY(-1)', 'scaleY(1)');
                    } else {
                        currentTransform += ' scaleY(-1)';
                    }
                    
                    // Add visual feedback
                    const gestureIndicator = document.querySelector('.gesture-indicator');
                    if (gestureIndicator) {
                        gestureIndicator.innerHTML += `
                            <span class="badge bg-success ms-2">Flipped Vertically</span>
                        `;
                        setTimeout(() => {
                            const badges = gestureIndicator.querySelectorAll('.badge.bg-success');
                            badges.forEach(badge => badge.remove());
                        }, 2000);
                    }
                } 
                else if (action === 'FLIP_VIDEO_DOWN') {
                    // Add or toggle horizontal flip
                    if (currentTransform.includes('scaleX(-1)')) {
                        currentTransform = currentTransform.replace('scaleX(-1)', 'scaleX(1)');
                    } else {
                        currentTransform += ' scaleX(-1)';
                    }
                    
                    // Add visual feedback
                    const gestureIndicator = document.querySelector('.gesture-indicator');
                    if (gestureIndicator) {
                        gestureIndicator.innerHTML += `
                            <span class="badge bg-success ms-2">Flipped Horizontally</span>
                        `;
                        setTimeout(() => {
                            const badges = gestureIndicator.querySelectorAll('.badge.bg-success');
                            badges.forEach(badge => badge.remove());
                        }, 2000);
                    }
                }
                
                // Apply the transform
                videoElement.style.transform = currentTransform.trim();
                
                // Also apply to canvas to match video
                if (canvasElement) {
                    canvasElement.style.transform = currentTransform.trim();
                }
            };
            
            // Main gesture detection loop
            const detectGestures = async () => {
                if (!detecting || !handposeModel || !videoElement || !canvasElement) return;
                
                try {
                    // Detect hand
                    const predictions = await handposeModel.estimateHands(videoElement);
                    
                    // Clear canvas
                    const ctx = canvasElement.getContext('2d');
                    ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);
                    
                    if (predictions.length > 0) {
                        // Get landmarks and draw them
                        const landmarks = predictions[0].landmarks;
                        
                        // Draw hand skeleton
                        ctx.fillStyle = '#4F46E5';
                        for (let i = 0; i < landmarks.length; i++) {
                            const [x, y] = landmarks[i];
                            ctx.beginPath();
                            ctx.arc(x, y, 5, 0, 2 * Math.PI);
                            ctx.fill();
                        }
                        
                        // Connect fingers with lines
                        const fingers = [
                            [0, 1, 2, 3, 4], // thumb
                            [0, 5, 6, 7, 8], // index
                            [0, 9, 10, 11, 12], // middle
                            [0, 13, 14, 15, 16], // ring
                            [0, 17, 18, 19, 20]  // pinky
                        ];
                        
                        ctx.strokeStyle = '#4F46E5';
                        ctx.lineWidth = 2;
                        
                        for (const finger of fingers) {
                            for (let i = 0; i < finger.length - 1; i++) {
                                const [x1, y1] = landmarks[finger[i]];
                                const [x2, y2] = landmarks[finger[i + 1]];
                                
                                ctx.beginPath();
                                ctx.moveTo(x1, y1);
                                ctx.lineTo(x2, y2);
                                ctx.stroke();
                            }
                        }
                        
                        // Estimate gestures
                        if (gestureEstimator) {
                            const estimate = gestureEstimator.estimate(landmarks, 7.5);
                            
                            if (estimate.gestures.length > 0) {
                                // Get gesture with highest confidence
                                const gesture = estimate.gestures.reduce(
                                    (prev, curr) => (prev.score > curr.score ? prev : curr)
                                );
                                
                                // Update gesture indicator
                                const gestureIndicator = document.querySelector('.gesture-indicator');
                                gestureIndicator.innerHTML = `
                                    <span class="badge bg-primary">${gesture.name.replace('_', ' ')}</span>
                                `;
                                
                                // Map gesture to action and execute
                                const action = gestureToAction[gesture.name];
                                if (action) {
                                    executeAction(action);
                                }
                            }
                        }
                    }
                    
                    // Continue detection loop
                    if (detecting) {
                        requestAnimationFrame(detectGestures);
                    }
                } catch (error) {
                    console.error('Error in gesture detection:', error);
                }
            };
            
            // Set up gesture detection buttons
            document.getElementById('startGestureBtn').addEventListener('click', () => {
                startGestureDetection();
                // Also turn on the gesture toggle in the home tab
                gestureToggle.checked = true;
                document.getElementById('gestureStatus').textContent = 'Active';
                document.getElementById('gestureStatus').className = 'text-success';
            });
            
            document.getElementById('stopGestureBtn').addEventListener('click', () => {
                stopGestureDetection();
                // Also turn off the gesture toggle in the home tab
                gestureToggle.checked = false;
                document.getElementById('gestureStatus').textContent = 'Inactive';
                document.getElementById('gestureStatus').className = 'text-secondary';
            });
            
            // ============ Language Switcher Implementation ============
            // Current language
            let currentLanguage = 'en';
            
            // Function to update all text elements with translations
            const updateTranslations = (language) => {
                currentLanguage = language;
                
                // Save language preference in localStorage
                localStorage.setItem('preferred_language', language);
                
                // Set direction for RTL languages (like Arabic)
                document.documentElement.setAttribute('dir', language === 'ar' ? 'rtl' : 'ltr');
                document.body.classList.toggle('rtl', language === 'ar');
                
                // Update all the text content
                updatePageTexts();
            };
            
            // Function to update all page text content based on the current language
            const updatePageTexts = () => {
                try {
                    // Update page title
                    document.title = translations[currentLanguage].appTitle;
                    
                    // Update main heading
                    const mainHeading = document.querySelector('h1');
                    if (mainHeading) mainHeading.textContent = translations[currentLanguage].appTitle;
                    
                    // Update navigation tabs
                    const homeTab = document.getElementById('home-tab');
                    if (homeTab) homeTab.textContent = translations[currentLanguage].home;
                    
                    const gesturesTab = document.getElementById('gestures-tab');
                    if (gesturesTab) gesturesTab.textContent = translations[currentLanguage].gestures;
                    
                    const voiceTab = document.getElementById('voice-tab');
                    if (voiceTab) voiceTab.textContent = translations[currentLanguage].voice;
                    
                    const gamesTab = document.getElementById('games-tab');
                    if (gamesTab) gamesTab.textContent = translations[currentLanguage].games;
                    
                    const settingsTab = document.getElementById('settings-tab');
                    if (settingsTab) settingsTab.textContent = translations[currentLanguage].settings;
                
                    // Update Home tab
                    const homeCardHeader = document.querySelector('#home .card-header:nth-of-type(1)');
                    if (homeCardHeader) homeCardHeader.textContent = translations[currentLanguage].controlPanel;
                    
                    const gestureControlLabel = document.querySelector('#home .d-flex:nth-of-type(1) > div:first-child');
                    if (gestureControlLabel) gestureControlLabel.textContent = translations[currentLanguage].gestureControl;
                    
                    const voiceControlLabel = document.querySelector('#home .d-flex:nth-of-type(2) > div:first-child');
                    if (voiceControlLabel) voiceControlLabel.textContent = translations[currentLanguage].voiceControl;
                    
                    const gestureWarning = document.getElementById('gestureWarning');
                    if (gestureWarning) gestureWarning.textContent = translations[currentLanguage].gesturesNotConfigured;
                    
                    const voiceWarning = document.getElementById('voiceWarning');
                    if (voiceWarning) voiceWarning.textContent = translations[currentLanguage].voiceNotEnrolled;
                    
                    const statusHeader = document.querySelector('#home .card-header:nth-of-type(2)');
                    if (statusHeader) statusHeader.textContent = translations[currentLanguage].status;
                    
                    const gestureControlStatus = document.querySelector('#home .d-flex:nth-of-type(3) > div:first-child');
                    if (gestureControlStatus) gestureControlStatus.textContent = translations[currentLanguage].gestureControlStatus;
                    
                    const voiceControlStatus = document.querySelector('#home .d-flex:nth-of-type(4) > div:first-child');
                    if (voiceControlStatus) voiceControlStatus.textContent = translations[currentLanguage].voiceControlStatus;
                    
                    const gesturesConfigured = document.querySelector('#home .d-flex:nth-of-type(5) > div:first-child');
                    if (gesturesConfigured) gesturesConfigured.textContent = translations[currentLanguage].gesturesConfigured;
                    
                    const voiceEnrolled = document.querySelector('#home .d-flex:nth-of-type(6) > div:first-child');
                    if (voiceEnrolled) voiceEnrolled.textContent = translations[currentLanguage].voiceEnrolled;
                
                // Update status text
                if (document.getElementById('gestureStatus').textContent === 'Active') {
                    document.getElementById('gestureStatus').textContent = translations[currentLanguage].active;
                } else {
                    document.getElementById('gestureStatus').textContent = translations[currentLanguage].inactive;
                }
                
                if (document.getElementById('voiceStatus').textContent === 'Active') {
                    document.getElementById('voiceStatus').textContent = translations[currentLanguage].active;
                } else {
                    document.getElementById('voiceStatus').textContent = translations[currentLanguage].inactive;
                }
                
                if (document.getElementById('gestureConfigStatus').textContent === 'Yes') {
                    document.getElementById('gestureConfigStatus').textContent = translations[currentLanguage].yes;
                } else {
                    document.getElementById('gestureConfigStatus').textContent = translations[currentLanguage].no;
                }
                
                if (document.getElementById('voiceEnrollStatus').textContent === 'Yes') {
                    document.getElementById('voiceEnrollStatus').textContent = translations[currentLanguage].yes;
                } else {
                    document.getElementById('voiceEnrollStatus').textContent = translations[currentLanguage].no;
                }
                
                document.querySelector('#home .card-header:nth-of-type(3)').textContent = translations[currentLanguage].recentCommands;
                document.getElementById('noCommands').textContent = translations[currentLanguage].noCommands;
                
                // Update Gestures tab
                document.querySelector('#gestures > p').textContent = translations[currentLanguage].gesturesIntro;
                document.querySelector('#gestures .card-header:nth-of-type(1)').textContent = translations[currentLanguage].gestureDetection;
                document.getElementById('startGestureBtn').textContent = translations[currentLanguage].startDetection;
                document.getElementById('stopGestureBtn').textContent = translations[currentLanguage].stopDetection;
                
                const lastDetectedText = document.querySelector('#detectedGestureInfo strong:nth-of-type(1)');
                if (lastDetectedText) lastDetectedText.textContent = translations[currentLanguage].lastDetected;
                
                const actionText = document.querySelector('#detectedGestureInfo strong:nth-of-type(2)');
                if (actionText) actionText.textContent = translations[currentLanguage].action;
                
                document.querySelector('#gestures .card-header:nth-of-type(2)').textContent = translations[currentLanguage].availableGestures;
                
                // Update gesture names
                const gestureItems = document.querySelectorAll('.gesture-item');
                if (gestureItems.length >= 1) {
                    gestureItems[0].querySelector('div:nth-of-type(2)').textContent = translations[currentLanguage].swipeRight;
                }
                if (gestureItems.length >= 2) {
                    gestureItems[1].querySelector('div:nth-of-type(2)').textContent = translations[currentLanguage].swipeLeft;
                }
                if (gestureItems.length >= 3) {
                    gestureItems[2].querySelector('div:nth-of-type(2)').textContent = translations[currentLanguage].thumbsUp;
                }
                if (gestureItems.length >= 4) {
                    gestureItems[3].querySelector('div:nth-of-type(2)').textContent = translations[currentLanguage].palm;
                }
                if (gestureItems.length >= 5) {
                    gestureItems[4].querySelector('div:nth-of-type(2)').textContent = translations[currentLanguage].pinch;
                }
                if (gestureItems.length >= 6) {
                    gestureItems[5].querySelector('div:nth-of-type(2)').textContent = translations[currentLanguage].pointUp;
                }
                if (gestureItems.length >= 7) {
                    gestureItems[6].querySelector('div:nth-of-type(2)').textContent = translations[currentLanguage].pointDown;
                }
                
                // Update train/retrain/delete buttons
                document.querySelectorAll('.btn-primary.btn-sm').forEach(btn => {
                    if (btn.textContent.trim() === 'Train') {
                        btn.textContent = translations[currentLanguage].train;
                    } else if (btn.textContent.trim() === 'Retrain') {
                        btn.textContent = translations[currentLanguage].retrain;
                    }
                });
                
                document.querySelectorAll('.btn-outline-danger.btn-sm').forEach(btn => {
                    btn.textContent = translations[currentLanguage].delete;
                });
                
                // Update badges
                document.querySelectorAll('.badge.bg-success.ms-2').forEach(badge => {
                    if (badge.textContent.trim() === 'Trained') {
                        badge.textContent = translations[currentLanguage].trained;
                    }
                });
                
                document.querySelectorAll('.badge.bg-info.ms-2').forEach(badge => {
                    if (badge.textContent.trim() === 'Flips Video Vertically') {
                        badge.textContent = translations[currentLanguage].flipsVideoVertically;
                    } else if (badge.textContent.trim() === 'Flips Video Horizontally') {
                        badge.textContent = translations[currentLanguage].flipsVideoHorizontally;
                    }
                });
                
                // Update Voice tab
                document.querySelector('#voice > p').textContent = translations[currentLanguage].voiceIntro;
                document.querySelector('#voice .card-header:nth-of-type(1)').textContent = translations[currentLanguage].enrollmentStatus;
                
                const h5Element = document.querySelector('#voiceNotEnrolled h5');
                if (h5Element) h5Element.textContent = translations[currentLanguage].readyToStart;
                
                const startRecordingBtn = document.getElementById('startRecording');
                if (startRecordingBtn) {
                    if (startRecordingBtn.textContent === 'Start Recording') {
                        startRecordingBtn.textContent = translations[currentLanguage].startRecording;
                    } else if (startRecordingBtn.textContent === 'Recording...') {
                        startRecordingBtn.textContent = translations[currentLanguage].recording;
                    } else if (startRecordingBtn.textContent === 'Finish Enrollment') {
                        startRecordingBtn.textContent = translations[currentLanguage].finishEnrollment;
                    }
                }
                
                const voiceEnrolledText = document.querySelector('#voiceEnrolled p');
                if (voiceEnrolledText) voiceEnrolledText.textContent = translations[currentLanguage].voiceEnrollmentSuccess;
                
                const clearEnrollmentBtn = document.querySelector('#voiceEnrolled button');
                if (clearEnrollmentBtn) clearEnrollmentBtn.textContent = translations[currentLanguage].clearEnrollment;
                
                document.querySelector('#voice .card-header:nth-of-type(2)').textContent = translations[currentLanguage].aboutVoiceEnrollment;
                
                const voiceDescriptionElements = document.querySelectorAll('#voice .card:nth-of-type(2) .card-body p');
                if (voiceDescriptionElements[0]) voiceDescriptionElements[0].textContent = translations[currentLanguage].voiceEnrollmentDescription;
                if (voiceDescriptionElements[1]) voiceDescriptionElements[1].textContent = translations[currentLanguage].benefits;
                
                const benefitsList = document.querySelectorAll('#voice .card:nth-of-type(2) .card-body li');
                if (benefitsList[0]) benefitsList[0].textContent = translations[currentLanguage].benefit1;
                if (benefitsList[1]) benefitsList[1].textContent = translations[currentLanguage].benefit2;
                if (benefitsList[2]) benefitsList[2].textContent = translations[currentLanguage].benefit3;
                
                // Update Games tab
                // Game Tabs
                const gestureMasterTab = document.getElementById('gesture-master-tab');
                if (gestureMasterTab) gestureMasterTab.textContent = translations[currentLanguage].gestureMaster;
                
                const footballTriviaTab = document.getElementById('football-trivia-tab');
                if (footballTriviaTab) footballTriviaTab.textContent = translations[currentLanguage].footballTrivia;
                
                // Gesture Master game content
                const gestureMasterTitle = document.querySelector('#gesture-master h3');
                if (gestureMasterTitle) gestureMasterTitle.textContent = translations[currentLanguage].gestureMaster;

                const gestureMasterDesc = document.getElementById('gestureMasterDescription');
                if (gestureMasterDesc && currentLanguage === 'ar') {
                    gestureMasterDesc.textContent = "اختبر مهاراتك في الإيماءات في هذه اللعبة الممتعة! طابق الإيماءة المعروضة بأسرع ما يمكن لتسجيل النقاط.";
                }
                
                // Match gesture header
                const matchGestureHeader = document.getElementById('matchGestureHeader');
                if (matchGestureHeader) matchGestureHeader.textContent = translations[currentLanguage].matchGesture;
                
                // Football Trivia game content
                const footballTriviaTitle = document.querySelector('#football-trivia h3');
                if (footballTriviaTitle) footballTriviaTitle.textContent = translations[currentLanguage].footballTrivia;
                
                const footballTriviaDesc = document.getElementById('footballTriviaDescription');
                if (footballTriviaDesc && currentLanguage === 'ar') {
                    footballTriviaDesc.textContent = "اختبر معرفتك بكرة القدم! أجب على أسئلة المسابقة باستخدام الإيماءات - الإبهام لأعلى للإجابة بـ صحيح، والإبهام لأسفل للإجابة بـ خطأ.";
                }
                
                // Football Question header
                const footballQuestionHeader = document.getElementById('footballQuestionHeader');
                if (footballQuestionHeader) footballQuestionHeader.textContent = translations[currentLanguage].footballQuestion + ":";
                
                // Game buttons and controls
                const startGameBtns = document.querySelectorAll('.startGameBtn');
                startGameBtns.forEach(btn => {
                    btn.textContent = translations[currentLanguage].startGame;
                });
                
                const endGameBtns = document.querySelectorAll('.endGameBtn');
                endGameBtns.forEach(btn => {
                    btn.textContent = translations[currentLanguage].endGame;
                });
                
                const startTriviaBtns = document.querySelectorAll('.startTriviaBtn');
                startTriviaBtns.forEach(btn => {
                    btn.textContent = translations[currentLanguage].startTrivia;
                });
                
                const endTriviaBtns = document.querySelectorAll('.endTriviaBtn');
                endTriviaBtns.forEach(btn => {
                    btn.textContent = translations[currentLanguage].endTrivia;
                });
                
                // Game labels
                const scoreLabels = document.querySelectorAll('.scoreLabel');
                scoreLabels.forEach(label => {
                    label.textContent = translations[currentLanguage].score + ':';
                });
                
                const timeLabels = document.querySelectorAll('.timeLabel');
                timeLabels.forEach(label => {
                    label.textContent = translations[currentLanguage].time + ':';
                });
                
                // True/False labels
                const trueLabels = document.querySelectorAll('.trueLabel');
                trueLabels.forEach(label => {
                    label.textContent = translations[currentLanguage].true;
                });
                
                const falseLabels = document.querySelectorAll('.falseLabel');
                falseLabels.forEach(label => {
                    label.textContent = translations[currentLanguage].false;
                });
                
                const highScoresHeaders = document.querySelectorAll('.highScoresHeader');
                highScoresHeaders.forEach(header => {
                    header.textContent = translations[currentLanguage].highScores;
                });
                
                const noScoresMessages = document.querySelectorAll('.noScoresMessage');
                noScoresMessages.forEach(msg => {
                    msg.textContent = translations[currentLanguage].noScores;
                });
                
                const noTriviaScoresMessages = document.querySelectorAll('.noTriviaScoresMessage');
                noTriviaScoresMessages.forEach(msg => {
                    msg.textContent = translations[currentLanguage].noTriviaScores;
                });
                
                // Update Settings tab
                document.querySelector('#settings .card:nth-of-type(1) .card-header').textContent = translations[currentLanguage].appearance;
                document.querySelector('#settings .card:nth-of-type(1) .d-flex > div').textContent = translations[currentLanguage].darkMode;
                
                document.querySelector('#settings .card:nth-of-type(2) .card-header').textContent = translations[currentLanguage].language;
                document.querySelector('#settings .card:nth-of-type(2) .d-flex > div').textContent = translations[currentLanguage].language;
                
                document.querySelector('#settings .card:nth-of-type(3) .card-header').textContent = translations[currentLanguage].accessibility;
                document.querySelector('#settings .card:nth-of-type(3) .d-flex:nth-of-type(1) > div:first-child').textContent = translations[currentLanguage].textSize;
                document.querySelector('#settings .card:nth-of-type(3) .d-flex:nth-of-type(2) > div:first-child').textContent = translations[currentLanguage].highContrast;
                
                    // Add null checks for all remaining query selectors
                    const recentCommandsHeader = document.querySelector('#home .card-header:nth-of-type(3)');
                    if (recentCommandsHeader) recentCommandsHeader.textContent = translations[currentLanguage].recentCommands;
                    
                    const noCommands = document.getElementById('noCommands');
                    if (noCommands) noCommands.textContent = translations[currentLanguage].noCommands;
                    
                    // Status elements
                    const gestureStatus = document.getElementById('gestureStatus');
                    if (gestureStatus) {
                        if (gestureStatus.textContent === 'Active') {
                            gestureStatus.textContent = translations[currentLanguage].active;
                        } else {
                            gestureStatus.textContent = translations[currentLanguage].inactive;
                        }
                    }
                    
                    const voiceStatus = document.getElementById('voiceStatus');
                    if (voiceStatus) {
                        if (voiceStatus.textContent === 'Active') {
                            voiceStatus.textContent = translations[currentLanguage].active;
                        } else {
                            voiceStatus.textContent = translations[currentLanguage].inactive;
                        }
                    }
                    
                    const gestureConfigStatus = document.getElementById('gestureConfigStatus');
                    if (gestureConfigStatus) {
                        if (gestureConfigStatus.textContent === 'Yes') {
                            gestureConfigStatus.textContent = translations[currentLanguage].yes;
                        } else {
                            gestureConfigStatus.textContent = translations[currentLanguage].no;
                        }
                    }
                    
                    const voiceEnrollStatus = document.getElementById('voiceEnrollStatus');
                    if (voiceEnrollStatus) {
                        if (voiceEnrollStatus.textContent === 'Yes') {
                            voiceEnrollStatus.textContent = translations[currentLanguage].yes;
                        } else {
                            voiceEnrollStatus.textContent = translations[currentLanguage].no;
                        }
                    }
                    
                    // Update Settings tab elements
                    const settingsElements = {
                        appearance: document.querySelector('#settings .card:nth-of-type(1) .card-header'),
                        darkMode: document.querySelector('#settings .card:nth-of-type(1) .d-flex > div'),
                        languageHeader: document.querySelector('#settings .card:nth-of-type(2) .card-header'),
                        languageLabel: document.querySelector('#settings .card:nth-of-type(2) .d-flex > div'),
                        accessibility: document.querySelector('#settings .card:nth-of-type(3) .card-header'),
                        textSize: document.querySelector('#settings .card:nth-of-type(3) .d-flex:nth-of-type(1) > div:first-child'),
                        highContrast: document.querySelector('#settings .card:nth-of-type(3) .d-flex:nth-of-type(2) > div:first-child'),
                        about: document.querySelector('#settings .card:nth-of-type(4) .card-header'),
                        version: document.querySelector('#settings .card:nth-of-type(4) .d-flex > div:first-child'),
                        dataManagement: document.querySelector('#settings .card:nth-of-type(5) .card-header'),
                        resetButton: document.querySelector('#settings .card:nth-of-type(5) button'),
                        resetWarning: document.querySelector('#settings .card:nth-of-type(5) small')
                    };
                    
                    if (settingsElements.appearance) settingsElements.appearance.textContent = translations[currentLanguage].appearance;
                    if (settingsElements.darkMode) settingsElements.darkMode.textContent = translations[currentLanguage].darkMode;
                    if (settingsElements.languageHeader) settingsElements.languageHeader.textContent = translations[currentLanguage].language;
                    if (settingsElements.languageLabel) settingsElements.languageLabel.textContent = translations[currentLanguage].language;
                    if (settingsElements.accessibility) settingsElements.accessibility.textContent = translations[currentLanguage].accessibility;
                    if (settingsElements.textSize) settingsElements.textSize.textContent = translations[currentLanguage].textSize;
                    if (settingsElements.highContrast) settingsElements.highContrast.textContent = translations[currentLanguage].highContrast;
                    if (settingsElements.about) settingsElements.about.textContent = translations[currentLanguage].about;
                    if (settingsElements.version) settingsElements.version.textContent = translations[currentLanguage].version;
                    if (settingsElements.dataManagement) settingsElements.dataManagement.textContent = translations[currentLanguage].dataManagement;
                    if (settingsElements.resetButton) settingsElements.resetButton.textContent = translations[currentLanguage].resetAppData;
                    if (settingsElements.resetWarning) settingsElements.resetWarning.textContent = translations[currentLanguage].resetWarning;
                    
                } catch (error) {
                    console.error('Error updating translations:', error);
                }
            };
            
            // Set up the language selector
            const languageSelector = document.getElementById('languageSelector');
            languageSelector.addEventListener('change', () => {
                updateTranslations(languageSelector.value);
            });
            
            // Initialize language from localStorage or browser preference
            const initializeLanguage = () => {
                // Try to get from localStorage
                const storedLang = localStorage.getItem('preferred_language');
                if (storedLang && (storedLang === 'en' || storedLang === 'ar')) {
                    languageSelector.value = storedLang;
                    updateTranslations(storedLang);
                    return;
                }
                
                // Fallback to browser language
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.startsWith('ar')) {
                    languageSelector.value = 'ar';
                    updateTranslations('ar');
                } else {
                    // Default to English
                    updateTranslations('en');
                }
            };
            
            // ============ Custom Gesture Implementation ============
            // Custom gesture variables
            let customGestureConfig = {
                type: 'open_url',
                value: ''
            };
            
            // Load custom gesture configuration from localStorage if available
            try {
                const savedConfig = localStorage.getItem('custom_gesture_config');
                if (savedConfig) {
                    customGestureConfig = JSON.parse(savedConfig);
                }
            } catch (error) {
                console.error('Error loading custom gesture config:', error);
            }
            
            // Configure custom action type help text
            const customActionType = document.getElementById('customActionType');
            const customActionHelp = document.getElementById('customActionHelp');
            const customActionValue = document.getElementById('customActionValue');
            
            if (customActionType) {
                customActionType.addEventListener('change', () => {
                    switch (customActionType.value) {
                        case 'open_url':
                            customActionHelp.textContent = 'Example: https://example.com';
                            break;
                        case 'open_app':
                            customActionHelp.textContent = 'Example: Calculator or Notepad';
                            break;
                        case 'keyboard_shortcut':
                            customActionHelp.textContent = 'Example: Ctrl+C or Alt+Tab';
                            break;
                        case 'custom_command':
                            customActionHelp.textContent = 'Example: volume up or brightness down';
                            break;
                    }
                });
            }
            
            // Set up the custom gesture modal
            const customGestureBtn = document.getElementById('customGestureBtn');
            const customGestureModal = new bootstrap.Modal(document.getElementById('customGestureModal'), {
                keyboard: false
            });
            
            // Open the custom gesture modal when Configure button is clicked
            if (customGestureBtn) {
                customGestureBtn.addEventListener('click', () => {
                    // Pre-fill form with saved values
                    if (customActionType && customActionValue) {
                        customActionType.value = customGestureConfig.type;
                        customActionValue.value = customGestureConfig.value;
                        
                        // Trigger change event to update help text
                        const event = new Event('change');
                        customActionType.dispatchEvent(event);
                    }
                    
                    // Show the modal
                    customGestureModal.show();
                });
            }
            
            // Save custom gesture configuration
            const saveCustomGestureBtn = document.getElementById('saveCustomGesture');
            if (saveCustomGestureBtn) {
                saveCustomGestureBtn.addEventListener('click', () => {
                    if (customActionType && customActionValue) {
                        // Update configuration
                        customGestureConfig = {
                            type: customActionType.value,
                            value: customActionValue.value
                        };
                        
                        // Save to localStorage
                        localStorage.setItem('custom_gesture_config', JSON.stringify(customGestureConfig));
                        
                        // Add to gesture recognizer
                        addVictoryGesture();
                        
                        // Add success message
                        const lastAction = document.querySelector("#lastGestureAction");
                        if (lastAction) {
                            lastAction.textContent = "Custom gesture configured: " + customGestureConfig.type;
                        }
                        
                        // Show configured gesture in history
                        addCommand("CUSTOM_GESTURE_CONFIGURED");
                        
                        // Hide modal
                        customGestureModal.hide();
                    }
                });
            }
            
            // Define Victory gesture (✌️)
            const addVictoryGesture = () => {
                if (window.fp && gestureEstimator) {
                    const fp = window.fp;
                    const victoryGesture = new fp.GestureDescription('victory');
                    
                    // Index and Middle finger extended
                    victoryGesture.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);
                    victoryGesture.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);
                    
                    // Other fingers curled
                    victoryGesture.addCurl(fp.Finger.Ring, fp.FingerCurl.FullCurl, 1.0);
                    victoryGesture.addCurl(fp.Finger.Pinky, fp.FingerCurl.FullCurl, 1.0);
                    victoryGesture.addCurl(fp.Finger.Thumb, fp.FingerCurl.HalfCurl, 0.8);
                    
                    // Index and Middle pointing up
                    victoryGesture.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);
                    victoryGesture.addDirection(fp.Finger.Middle, fp.FingerDirection.VerticalUp, 1.0);
                    
                    // Add to gesture estimator
                    const gestures = [...gestureEstimator.gestures];
                    const existingIndex = gestures.findIndex(g => g.name === 'victory');
                    
                    if (existingIndex !== -1) {
                        // Replace existing gesture
                        gestures[existingIndex] = victoryGesture;
                    } else {
                        // Add new gesture
                        gestures.push(victoryGesture);
                    }
                    
                    // Update gesture estimator
                    gestureEstimator.gestures = gestures;
                }
            };
            
            // Function to execute custom action
            const executeCustomAction = (action) => {
                if (!action || !action.type || !action.value) return;
                
                switch (action.type) {
                    case 'open_url':
                        if (action.value.startsWith('http')) {
                            window.open(action.value, '_blank');
                            addCommand('OPENED_URL: ' + action.value);
                        }
                        break;
                    case 'open_app':
                        // In a real implementation, this would use a native API
                        // For the demo, we'll just show a message
                        alert(`Launching application: ${action.value}`);
                        addCommand('LAUNCHED_APP: ' + action.value);
                        break;
                    case 'keyboard_shortcut':
                        // In a real implementation, this would trigger OS keyboard events
                        // For the demo, we'll just show a message
                        alert(`Sending keyboard shortcut: ${action.value}`);
                        addCommand('SENT_SHORTCUT: ' + action.value);
                        break;
                    case 'custom_command':
                        // Execute custom command
                        if (action.value.toLowerCase().includes('volume')) {
                            alert(`Adjusting volume: ${action.value}`);
                            addCommand('VOLUME_CONTROL: ' + action.value);
                        } else if (action.value.toLowerCase().includes('brightness')) {
                            alert(`Adjusting brightness: ${action.value}`);
                            addCommand('BRIGHTNESS_CONTROL: ' + action.value);
                        } else {
                            alert(`Executing command: ${action.value}`);
                            addCommand('CUSTOM_COMMAND: ' + action.value);
                        }
                        break;
                }
                
                const lastAction = document.querySelector("#lastGestureAction");
                if (lastAction) {
                    lastAction.textContent = action.type + ": " + action.value;
                }
            };
            
            // Update gesture to action mapping to include victory gesture
            const originalGestureToAction = window.gestureToAction || {};
            window.gestureToAction = {
                ...originalGestureToAction,
                'victory': 'CUSTOM_ACTION'
            };
            
            // Modify executeAction to handle custom action
            const originalExecuteAction = window.executeAction || function() {};
            window.executeAction = (action) => {
                if (action === 'CUSTOM_ACTION') {
                    executeCustomAction(customGestureConfig);
                    
                    // Update the last detected gesture info
                    const lastGestureName = document.getElementById('lastGestureName');
                    const lastGestureAction = document.getElementById('lastGestureAction');
                    
                    if (lastGestureName) lastGestureName.textContent = 'Victory';
                    if (lastGestureAction) lastGestureAction.textContent = customGestureConfig.type + ': ' + customGestureConfig.value;
                    
                    // Show gesture info section
                    const gestureInfo = document.getElementById('detectedGestureInfo');
                    if (gestureInfo) gestureInfo.classList.remove('d-none');
                    
                    return;
                }
                
                // Call the original action handler for other actions
                originalExecuteAction(action);
            };
            
            // Add translations for custom gesture
            if (translations.en) {
                translations.en.victoryGesture = "Victory";
                translations.en.customAction = "Custom Action";
                translations.en.configureGesture = "Configure";
                translations.en.customGestureTitle = "Configure Custom Gesture";
                translations.en.gestureName = "Gesture Name";
                translations.en.actionType = "Action Type";
                translations.en.actionValue = "Action Value";
                translations.en.openUrl = "Open URL";
                translations.en.launchApp = "Launch Application";
                translations.en.keyboardShortcut = "Keyboard Shortcut";
                translations.en.customCommand = "Custom Command";
                translations.en.cancel = "Cancel";
                translations.en.save = "Save";
            }
            
            if (translations.ar) {
                translations.ar.victoryGesture = "النصر";
                translations.ar.customAction = "إجراء مخصص";
                translations.ar.configureGesture = "تكوين";
                translations.ar.customGestureTitle = "تكوين إيماءة مخصصة";
                translations.ar.gestureName = "اسم الإيماءة";
                translations.ar.actionType = "نوع الإجراء";
                translations.ar.actionValue = "قيمة الإجراء";
                translations.ar.openUrl = "فتح عنوان URL";
                translations.ar.launchApp = "تشغيل التطبيق";
                translations.ar.keyboardShortcut = "اختصار لوحة المفاتيح";
                translations.ar.customCommand = "أمر مخصص";
                translations.ar.cancel = "إلغاء";
                translations.ar.save = "حفظ";
            }
            
            // Initialize language preference
            initializeLanguage();
            
            // ============ Gesture Master Game ============
            
            // Game state
            let gameActive = false;
            let gameScore = 0;
            let gameTimer = 60;
            let gameTimerInterval = null;
            let targetGesture = '';
            let gesturesMatched = 0;
            let highScores = [];
            
            // Get DOM elements
            const startGameBtn = document.getElementById('startGameBtn');
            const stopGameBtn = document.getElementById('stopGameBtn');
            const gameScoreElement = document.getElementById('gameScore');
            const gameTimerElement = document.getElementById('gameTimer');
            const targetGestureElement = document.getElementById('targetGesture');
            const gestureResultElement = document.getElementById('gestureResult');
            const gameGestureDetector = document.getElementById('gameGestureDetector');
            const highScoresTable = document.getElementById('highScoresTable');
            
            // Available gestures for the game
            const gameGestures = [
                { name: 'thumbs_up', icon: '👍', display: 'Thumbs Up' },
                { name: 'victory', icon: '✌️', display: 'Victory' },
                { name: 'pointing_up', icon: '☝️', display: 'Point Up' },
                { name: 'pointing_down', icon: '👇', display: 'Point Down' },
                { name: 'open_palm', icon: '✋', display: 'Open Palm' },
                { name: 'pinch', icon: '👌', display: 'Pinch' }
            ];
            
            // Initialize game canvas
            let gameVideoElement = null;
            let gameCanvasElement = null;
            let gameDetecting = false;
            
            // Initialize game detection
            const initializeGameDetection = async () => {
                if (gameGestureDetector) {
                    // Create video element for gesture detection
                    gameVideoElement = document.createElement('video');
                    gameVideoElement.classList.add('gesture-video');
                    gameVideoElement.setAttribute('playsinline', true);
                    gameVideoElement.setAttribute('autoplay', true);
                    
                    // Create canvas for drawing hand landmarks
                    gameCanvasElement = document.createElement('canvas');
                    gameCanvasElement.classList.add('gesture-canvas');
                    gameCanvasElement.width = 640;
                    gameCanvasElement.height = 480;
                    
                    // Clear previous content and append new elements
                    gameGestureDetector.innerHTML = '';
                    gameGestureDetector.appendChild(gameVideoElement);
                    gameGestureDetector.appendChild(gameCanvasElement);
                    
                    // Ensure TensorFlow and handpose are initialized
                    if (!handposeModel) {
                        const initialized = await initTensorFlow();
                        if (!initialized) {
                            gameGestureDetector.innerHTML = `
                                <div class="alert alert-danger" role="alert">
                                    Failed to initialize TensorFlow. Please refresh the page and try again.
                                </div>
                            `;
                            return false;
                        }
                    }
                    
                    return true;
                }
                return false;
            };
            
            // Set a random target gesture for the player to match
            const setRandomTargetGesture = () => {
                const randomIndex = Math.floor(Math.random() * gameGestures.length);
                const gesture = gameGestures[randomIndex];
                targetGesture = gesture.name;
                
                if (targetGestureElement) {
                    targetGestureElement.innerHTML = `
                        <div class="gesture-icon" style="font-size: 4rem;">${gesture.icon}</div>
                        <h4>${gesture.display}</h4>
                    `;
                }
            };
            
            // Show gesture match result (correct/incorrect)
            const showGestureResult = (matched) => {
                if (gestureResultElement) {
                    gestureResultElement.classList.remove('d-none', 'alert-success', 'alert-danger');
                    gestureResultElement.classList.add(matched ? 'alert-success' : 'alert-danger');
                    gestureResultElement.innerHTML = matched ? 
                        '<strong>Correct!</strong> +10 points' : 
                        '<strong>Try Again!</strong> Match the shown gesture';
                    
                    // Hide the result after 2 seconds
                    setTimeout(() => {
                        gestureResultElement.classList.add('d-none');
                    }, 2000);
                }
            };
            
            // Update game score
            const updateScore = (points) => {
                gameScore += points;
                if (gameScoreElement) {
                    gameScoreElement.textContent = gameScore;
                }
            };
            
            // Start game timer
            const startGameTimer = () => {
                gameTimer = 60;
                gameTimerElement.textContent = gameTimer;
                
                gameTimerInterval = setInterval(() => {
                    gameTimer--;
                    if (gameTimerElement) {
                        gameTimerElement.textContent = gameTimer;
                    }
                    
                    // Game over when timer reaches 0
                    if (gameTimer <= 0) {
                        clearInterval(gameTimerInterval);
                        endGame();
                    }
                }, 1000);
            };
            
            // Main game loop for gesture detection
            const gameDetectionLoop = async () => {
                if (!gameDetecting || !handposeModel || !gameVideoElement || !gameCanvasElement) return;
                
                try {
                    // Detect hand
                    const predictions = await handposeModel.estimateHands(gameVideoElement);
                    
                    // Clear canvas
                    const ctx = gameCanvasElement.getContext('2d');
                    ctx.clearRect(0, 0, gameCanvasElement.width, gameCanvasElement.height);
                    
                    if (predictions.length > 0) {
                        // Get landmarks and draw them
                        const landmarks = predictions[0].landmarks;
                        
                        // Draw hand skeleton
                        ctx.fillStyle = '#4F46E5';
                        for (let i = 0; i < landmarks.length; i++) {
                            const [x, y] = landmarks[i];
                            ctx.beginPath();
                            ctx.arc(x, y, 5, 0, 2 * Math.PI);
                            ctx.fill();
                        }
                        
                        // Connect fingers with lines
                        const fingers = [
                            [0, 1, 2, 3, 4], // thumb
                            [0, 5, 6, 7, 8], // index
                            [0, 9, 10, 11, 12], // middle
                            [0, 13, 14, 15, 16], // ring
                            [0, 17, 18, 19, 20]  // pinky
                        ];
                        
                        ctx.strokeStyle = '#4F46E5';
                        ctx.lineWidth = 2;
                        
                        for (const finger of fingers) {
                            for (let i = 0; i < finger.length - 1; i++) {
                                const [x1, y1] = landmarks[finger[i]];
                                const [x2, y2] = landmarks[finger[i + 1]];
                                
                                ctx.beginPath();
                                ctx.moveTo(x1, y1);
                                ctx.lineTo(x2, y2);
                                ctx.stroke();
                            }
                        }
                        
                        // Estimate gestures
                        if (gestureEstimator) {
                            const estimate = gestureEstimator.estimate(landmarks, 7.5);
                            
                            if (estimate.gestures.length > 0) {
                                // Get gesture with highest confidence
                                const gesture = estimate.gestures.reduce(
                                    (prev, curr) => (prev.score > curr.score ? prev : curr)
                                );
                                
                                // Check if detected gesture matches target
                                if (gesture.name === targetGesture && gesture.score > 7.5) {
                                    // Award points, show success, and set new target
                                    updateScore(10);
                                    gesturesMatched++;
                                    showGestureResult(true);
                                    setRandomTargetGesture();
                                }
                            }
                        }
                    }
                    
                    // Continue detection loop
                    if (gameDetecting) {
                        requestAnimationFrame(gameDetectionLoop);
                    }
                } catch (error) {
                    console.error('Error in game detection:', error);
                }
            };
            
            // Start the game
            const startGame = async () => {
                if (gameActive) return;
                
                // Reset game state
                gameScore = 0;
                gameScoreElement.textContent = gameScore;
                gesturesMatched = 0;
                
                try {
                    // Initialize camera and detection
                    const initialized = await initializeGameDetection();
                    
                    if (!initialized) {
                        throw new Error('Failed to initialize game detection');
                    }
                    
                    // Request camera access
                    videoStream = await navigator.mediaDevices.getUserMedia({
                        video: { width: 640, height: 480 },
                        audio: false
                    });
                    
                    // Set video source
                    gameVideoElement.srcObject = videoStream;
                    await gameVideoElement.play();
                    
                    // Set initial canvas dimensions
                    gameCanvasElement.width = gameVideoElement.videoWidth;
                    gameCanvasElement.height = gameVideoElement.videoHeight;
                    
                    // Set random target gesture to start
                    setRandomTargetGesture();
                    
                    // Start detection loop
                    gameDetecting = true;
                    gameActive = true;
                    gameDetectionLoop();
                    
                    // Start timer
                    startGameTimer();
                    
                    // Update buttons
                    startGameBtn.disabled = true;
                    stopGameBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Error starting game:', error);
                    gameGestureDetector.innerHTML = `
                        <div class="alert alert-danger" role="alert">
                            Error starting game: ${error.message}
                        </div>
                    `;
                }
            };
            
            // End the game
            const endGame = () => {
                if (!gameActive) return;
                
                // Stop detection
                gameDetecting = false;
                gameActive = false;
                
                // Stop camera
                if (videoStream) {
                    videoStream.getTracks().forEach(track => track.stop());
                }
                
                // Stop timer
                clearInterval(gameTimerInterval);
                
                // Reset UI
                startGameBtn.disabled = false;
                stopGameBtn.disabled = true;
                
                // Save high score
                saveHighScore({
                    score: gameScore,
                    date: new Date().toLocaleDateString(),
                    gestures: gesturesMatched
                });
                
                // Show game over message
                gameGestureDetector.innerHTML = `
                    <div class="text-center p-4">
                        <h3>Game Over!</h3>
                        <p class="mb-3">Your score: <strong>${gameScore}</strong></p>
                        <p>Gestures matched: <strong>${gesturesMatched}</strong></p>
                    </div>
                `;
            };
            
            // Save high score
            const saveHighScore = (score) => {
                // Load existing scores
                const savedScores = localStorage.getItem('gestureGameHighScores');
                highScores = savedScores ? JSON.parse(savedScores) : [];
                
                // Add new score
                highScores.push(score);
                
                // Sort scores
                highScores.sort((a, b) => b.score - a.score);
                
                // Keep only top 10
                if (highScores.length > 10) {
                    highScores = highScores.slice(0, 10);
                }
                
                // Save to local storage
                localStorage.setItem('gestureGameHighScores', JSON.stringify(highScores));
                
                // Update high scores table
                updateHighScoresTable();
            };
            
            // Update high scores table
            const updateHighScoresTable = () => {
                const tbody = highScoresTable.querySelector('tbody');
                
                if (highScores.length === 0) {
                    tbody.innerHTML = `
                        <tr id="noScoresRow">
                            <td colspan="4" class="text-center">No high scores yet. Play a game to set your first score!</td>
                        </tr>
                    `;
                    return;
                }
                
                // Remove the no scores row if it exists
                const noScoresRow = document.getElementById('noScoresRow');
                if (noScoresRow) {
                    noScoresRow.remove();
                }
                
                // Clear existing rows
                tbody.innerHTML = '';
                
                // Add score rows
                highScores.forEach((score, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${score.score}</td>
                        <td>${score.date}</td>
                        <td>${score.gestures}</td>
                    `;
                    tbody.appendChild(row);
                });
            };
            
            // Game event listeners
            if (startGameBtn) {
                startGameBtn.addEventListener('click', startGame);
            }
            
            if (stopGameBtn) {
                stopGameBtn.addEventListener('click', endGame);
            }
            
            // Load high scores on init
            const loadHighScores = () => {
                const savedScores = localStorage.getItem('gestureGameHighScores');
                if (savedScores) {
                    highScores = JSON.parse(savedScores);
                    updateHighScoresTable();
                }
            };
            
            // Initialize high scores
            loadHighScores();
            
            // Add translations for games
            if (translations.en) {
                translations.en.gestureMaster = "Gesture Master";
                translations.en.matchGesture = "Match This Gesture";
                translations.en.gameControls = "Game Controls";
                translations.en.startGame = "Start Game";
                translations.en.endGame = "End Game";
                translations.en.score = "Score";
                translations.en.time = "Time";
                translations.en.highScores = "High Scores";
                translations.en.gameOver = "Game Over";
                translations.en.gestures = "Gestures";
                translations.en.noScores = "No high scores yet. Play a game to set your first score!";
            }
            
            if (translations.ar) {
                translations.ar.gestureMaster = "سيد الإيماءات";
                translations.ar.matchGesture = "طابق هذه الإيماءة";
                translations.ar.gameControls = "ضوابط اللعبة";
                translations.ar.startGame = "ابدأ اللعبة";
                translations.ar.endGame = "إنهاء اللعبة";
                translations.ar.score = "النتيجة";
                translations.ar.time = "الوقت";
                translations.ar.highScores = "أعلى الدرجات";
                translations.ar.gameOver = "انتهت اللعبة";
                translations.ar.gestures = "الإيماءات";
                translations.ar.noScores = "لا توجد درجات عالية حتى الآن. العب لعبة لتعيين أول نتيجة لك!";
            }
            
            // ============ Football Trivia Game ============
            
            // Game tabs event listeners
            document.getElementById('gesture-master-tab').addEventListener('click', function() {
                document.getElementById('gesture-master-content').style.display = 'block';
                document.getElementById('football-trivia-content').style.display = 'none';
            });
            
            document.getElementById('football-trivia-tab').addEventListener('click', function() {
                document.getElementById('gesture-master-content').style.display = 'none';
                document.getElementById('football-trivia-content').style.display = 'block';
            });
            
            // Football trivia game variables
            let triviaActive = false;
            let triviaScore = 0;
            let correctAnswers = 0;
            let currentQuestionIndex = 0;
            let triviaQuestions = [];
            let triviaDetecting = false;
            let triviaTimerInterval = null;
            let triviaVideoElement = null;
            let triviaCanvasElement = null;
            let triviaHighScores = [];
            
            // DOM elements
            const startTriviaBtn = document.getElementById('startTriviaBtn');
            const stopTriviaBtn = document.getElementById('stopTriviaBtn');
            const triviaScoreElement = document.getElementById('triviaScore');
            const correctAnswersElement = document.getElementById('correctAnswers');
            const questionNumberElement = document.getElementById('questionNumber');
            const triviaQuestionElement = document.getElementById('triviaQuestion');
            const triviaGestureDetector = document.getElementById('triviaGestureDetector');
            const answerResultElement = document.getElementById('answerResult');
            const triviaExplanationElement = document.getElementById('triviaExplanation');
            const triviaScoresTable = document.getElementById('triviaScoresTable');
            
            // Football trivia questions (true/false format)
            const footballTriviaQuestions = [
                {
                    question: "The first FIFA World Cup was held in 1930 in Uruguay.",
                    answer: true,
                    explanation: "The inaugural FIFA World Cup tournament was indeed hosted by Uruguay in 1930."
                },
                {
                    question: "Lionel Messi has won more Ballon d'Or awards than Cristiano Ronaldo.",
                    answer: true,
                    explanation: "As of 2023, Lionel Messi has won 8 Ballon d'Or awards, while Cristiano Ronaldo has won 5."
                },
                {
                    question: "A standard football match consists of four 30-minute quarters.",
                    answer: false,
                    explanation: "A standard match consists of two 45-minute halves, not four quarters."
                },
                {
                    question: "Brazil has won the most FIFA World Cup tournaments.",
                    answer: true,
                    explanation: "Brazil has won the World Cup 5 times (1958, 1962, 1970, 1994, 2002)."
                },
                {
                    question: "A penalty kick is taken from 10 yards away from the goal.",
                    answer: false,
                    explanation: "A penalty kick is taken from 12 yards (11 meters) away from the goal."
                },
                {
                    question: "The offside rule was introduced to football in the 1990s.",
                    answer: false,
                    explanation: "The offside rule has existed in football since the 19th century, with various modifications over time."
                },
                {
                    question: "The maximum number of substitutions allowed in a standard match is three.",
                    answer: true,
                    explanation: "Traditionally, a maximum of three substitutions were allowed in professional matches (though some competitions now allow more)."
                },
                {
                    question: "The first Women's World Cup was held in 1991.",
                    answer: true,
                    explanation: "The inaugural FIFA Women's World Cup was held in China in 1991."
                },
                {
                    question: "The FA Cup is the oldest football competition in the world.",
                    answer: true,
                    explanation: "Founded in 1871, the FA Cup is the oldest national football competition in the world."
                },
                {
                    question: "A football field must be exactly 100 yards long to meet international standards.",
                    answer: false,
                    explanation: "According to FIFA regulations, a football field can be between 100-130 yards (90-120 meters) in length."
                },
                {
                    question: "Pele scored over 1,000 goals in his professional career.",
                    answer: true,
                    explanation: "Pele scored 1,279 goals in 1,363 games, including friendlies and unofficial matches."
                },
                {
                    question: "The Champions League was originally called the European Cup.",
                    answer: true,
                    explanation: "The competition was renamed from European Cup to UEFA Champions League in 1992."
                },
                {
                    question: "A goalkeeper can handle the ball anywhere inside their own half.",
                    answer: false,
                    explanation: "Goalkeepers can only handle the ball inside their own penalty area."
                },
                {
                    question: "Red and yellow cards were introduced at the 1970 World Cup.",
                    answer: true,
                    explanation: "Referee Ken Aston introduced the card system at the 1970 FIFA World Cup in Mexico."
                },
                {
                    question: "The term 'hat-trick' originated in cricket, not football.",
                    answer: true,
                    explanation: "The term originated in cricket when a bowler took three wickets with consecutive deliveries."
                }
            ];
            
            // Initialize trivia game
            const initializeTriviaGame = async () => {
                if (triviaGestureDetector) {
                    // Create video element for gesture detection
                    triviaVideoElement = document.createElement('video');
                    triviaVideoElement.classList.add('gesture-video');
                    triviaVideoElement.setAttribute('playsinline', true);
                    triviaVideoElement.setAttribute('autoplay', true);
                    
                    // Create canvas for drawing hand landmarks
                    triviaCanvasElement = document.createElement('canvas');
                    triviaCanvasElement.classList.add('gesture-canvas');
                    triviaCanvasElement.width = 640;
                    triviaCanvasElement.height = 480;
                    
                    // Clear previous content and append new elements
                    triviaGestureDetector.innerHTML = '';
                    triviaGestureDetector.appendChild(triviaVideoElement);
                    triviaGestureDetector.appendChild(triviaCanvasElement);
                    
                    // Ensure TensorFlow and handpose are initialized
                    if (!handposeModel) {
                        const initialized = await initTensorFlow();
                        if (!initialized) {
                            triviaGestureDetector.innerHTML = `
                                <div class="alert alert-danger" role="alert">
                                    Failed to initialize TensorFlow. Please refresh the page and try again.
                                </div>
                            `;
                            return false;
                        }
                    }
                    
                    return true;
                }
                return false;
            };
            
            // Shuffle questions and get a random set
            const shuffleAndSelectQuestions = () => {
                // Shuffle the array
                const shuffled = [...footballTriviaQuestions].sort(() => Math.random() - 0.5);
                // Get the first 10 questions
                return shuffled.slice(0, 10);
            };
            
            // Display the current question
            const displayCurrentQuestion = () => {
                const question = triviaQuestions[currentQuestionIndex];
                triviaQuestionElement.textContent = question.question;
                questionNumberElement.textContent = (currentQuestionIndex + 1);
                
                // Hide previous result and explanation
                answerResultElement.classList.add('d-none');
                triviaExplanationElement.classList.add('d-none');
            };
            
            // Check user answer
            const checkAnswer = (userAnswer) => {
                if (!triviaActive) return;
                
                const question = triviaQuestions[currentQuestionIndex];
                const isCorrect = userAnswer === question.answer;
                
                // Show result
                answerResultElement.classList.remove('d-none', 'alert-success', 'alert-danger');
                answerResultElement.classList.add(isCorrect ? 'alert-success' : 'alert-danger');
                answerResultElement.innerHTML = isCorrect ? 
                    '<strong>Correct!</strong> +10 points' : 
                    '<strong>Wrong!</strong> The answer was ' + (question.answer ? 'True' : 'False');
                
                // Show explanation
                triviaExplanationElement.classList.remove('d-none');
                triviaExplanationElement.textContent = question.explanation;
                
                // Update score
                if (isCorrect) {
                    triviaScore += 10;
                    correctAnswers++;
                    triviaScoreElement.textContent = triviaScore;
                    correctAnswersElement.textContent = correctAnswers;
                }
                
                // Move to next question after a delay
                setTimeout(() => {
                    currentQuestionIndex++;
                    
                    // End game if all questions answered
                    if (currentQuestionIndex >= triviaQuestions.length) {
                        endTriviaGame();
                    } else {
                        displayCurrentQuestion();
                    }
                }, 3000);
            };
            
            // Trivia gesture detection loop
            const triviaDetectionLoop = async () => {
                if (!triviaDetecting || !handposeModel || !triviaVideoElement || !triviaCanvasElement) return;
                
                try {
                    // Detect hand
                    const predictions = await handposeModel.estimateHands(triviaVideoElement);
                    
                    // Clear canvas
                    const ctx = triviaCanvasElement.getContext('2d');
                    ctx.clearRect(0, 0, triviaCanvasElement.width, triviaCanvasElement.height);
                    
                    if (predictions.length > 0) {
                        // Get landmarks and draw them
                        const landmarks = predictions[0].landmarks;
                        
                        // Draw hand skeleton
                        ctx.fillStyle = '#4F46E5';
                        for (let i = 0; i < landmarks.length; i++) {
                            const [x, y] = landmarks[i];
                            ctx.beginPath();
                            ctx.arc(x, y, 5, 0, 2 * Math.PI);
                            ctx.fill();
                        }
                        
                        // Connect fingers with lines
                        const fingers = [
                            [0, 1, 2, 3, 4], // thumb
                            [0, 5, 6, 7, 8], // index
                            [0, 9, 10, 11, 12], // middle
                            [0, 13, 14, 15, 16], // ring
                            [0, 17, 18, 19, 20]  // pinky
                        ];
                        
                        ctx.strokeStyle = '#4F46E5';
                        ctx.lineWidth = 2;
                        
                        for (const finger of fingers) {
                            for (let i = 0; i < finger.length - 1; i++) {
                                const [x1, y1] = landmarks[finger[i]];
                                const [x2, y2] = landmarks[finger[i + 1]];
                                
                                ctx.beginPath();
                                ctx.moveTo(x1, y1);
                                ctx.lineTo(x2, y2);
                                ctx.stroke();
                            }
                        }
                        
                        // Estimate gestures
                        if (gestureEstimator) {
                            const estimate = gestureEstimator.estimate(landmarks, 7.5);
                            
                            if (estimate.gestures.length > 0) {
                                // Get gesture with highest confidence
                                const gesture = estimate.gestures.reduce(
                                    (prev, curr) => (prev.score > curr.score ? prev : curr)
                                );
                                
                                // If thumbs up/down detected, register answer
                                if (gesture.score > 7.5) {
                                    if (gesture.name === 'thumbs_up') {
                                        checkAnswer(true);
                                    } else if (gesture.name === 'thumbs_down') {
                                        checkAnswer(false);
                                    }
                                }
                            }
                        }
                    }
                    
                    // Continue detection loop
                    if (triviaDetecting) {
                        requestAnimationFrame(triviaDetectionLoop);
                    }
                } catch (error) {
                    console.error('Error in trivia detection:', error);
                }
            };
            
            // Define thumbs down gesture
            const defineThumbsDownGesture = () => {
                const fp = window.fp;
                if (!fp) return;
                
                const thumbsDownGesture = new fp.GestureDescription('thumbs_down');
                thumbsDownGesture.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);
                thumbsDownGesture.addDirection(fp.Finger.Thumb, fp.FingerDirection.VerticalDown, 1.0);
                thumbsDownGesture.addCurl(fp.Finger.Index, fp.FingerCurl.FullCurl, 1.0);
                thumbsDownGesture.addCurl(fp.Finger.Middle, fp.FingerCurl.FullCurl, 1.0);
                thumbsDownGesture.addCurl(fp.Finger.Ring, fp.FingerCurl.FullCurl, 1.0);
                thumbsDownGesture.addCurl(fp.Finger.Pinky, fp.FingerCurl.FullCurl, 1.0);
                
                // Add to estimator
                if (gestureEstimator) {
                    gestureEstimator.addGesture('thumbs_down', thumbsDownGesture);
                }
            };
            
            // Start the trivia game
            const startTriviaGame = async () => {
                if (triviaActive) return;
                
                // Reset game state
                triviaScore = 0;
                triviaScoreElement.textContent = triviaScore;
                correctAnswers = 0;
                correctAnswersElement.textContent = correctAnswers;
                currentQuestionIndex = 0;
                
                // Shuffle and select questions
                triviaQuestions = shuffleAndSelectQuestions();
                
                try {
                    // Initialize game
                    const initialized = await initializeTriviaGame();
                    
                    if (!initialized) {
                        throw new Error('Failed to initialize trivia game');
                    }
                    
                    // Add thumbs down gesture
                    defineThumbsDownGesture();
                    
                    // Request camera access
                    videoStream = await navigator.mediaDevices.getUserMedia({
                        video: { width: 640, height: 480 },
                        audio: false
                    });
                    
                    // Set video source
                    triviaVideoElement.srcObject = videoStream;
                    await triviaVideoElement.play();
                    
                    // Set initial canvas dimensions
                    triviaCanvasElement.width = triviaVideoElement.videoWidth;
                    triviaCanvasElement.height = triviaVideoElement.videoHeight;
                    
                    // Display first question
                    displayCurrentQuestion();
                    
                    // Start detection loop
                    triviaDetecting = true;
                    triviaActive = true;
                    triviaDetectionLoop();
                    
                    // Update buttons
                    startTriviaBtn.disabled = true;
                    stopTriviaBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Error starting trivia game:', error);
                    triviaGestureDetector.innerHTML = `
                        <div class="alert alert-danger" role="alert">
                            Error starting trivia game: ${error.message}
                        </div>
                    `;
                }
            };
            
            // End the trivia game
            const endTriviaGame = () => {
                if (!triviaActive) return;
                
                // Stop detection
                triviaDetecting = false;
                triviaActive = false;
                
                // Stop camera
                if (videoStream) {
                    videoStream.getTracks().forEach(track => track.stop());
                }
                
                // Reset UI
                startTriviaBtn.disabled = false;
                stopTriviaBtn.disabled = true;
                
                // Save score
                saveTriviaScore({
                    score: triviaScore,
                    date: new Date().toLocaleDateString(),
                    correct: correctAnswers
                });
                
                // Show game over message
                triviaGestureDetector.innerHTML = `
                    <div class="text-center p-4">
                        <h3>Game Over!</h3>
                        <p class="mb-3">Your score: <strong>${triviaScore}</strong></p>
                        <p>Correct answers: <strong>${correctAnswers}</strong> out of ${triviaQuestions.length}</p>
                    </div>
                `;
                
                // Show final result
                triviaQuestionElement.textContent = "Game Over! Check your final score.";
            };
            
            // Save trivia score
            const saveTriviaScore = (score) => {
                // Load existing scores
                const savedScores = localStorage.getItem('footballTriviaHighScores');
                triviaHighScores = savedScores ? JSON.parse(savedScores) : [];
                
                // Add new score
                triviaHighScores.push(score);
                
                // Sort scores
                triviaHighScores.sort((a, b) => b.score - a.score);
                
                // Keep only top 10
                if (triviaHighScores.length > 10) {
                    triviaHighScores = triviaHighScores.slice(0, 10);
                }
                
                // Save to local storage
                localStorage.setItem('footballTriviaHighScores', JSON.stringify(triviaHighScores));
                
                // Update high scores table
                updateTriviaScoresTable();
            };
            
            // Update trivia high scores table
            const updateTriviaScoresTable = () => {
                const tbody = triviaScoresTable.querySelector('tbody');
                
                if (triviaHighScores.length === 0) {
                    tbody.innerHTML = `
                        <tr id="noTriviaScoresRow">
                            <td colspan="4" class="text-center">No trivia scores yet. Play the game to set your first score!</td>
                        </tr>
                    `;
                    return;
                }
                
                // Remove the no scores row if it exists
                const noScoresRow = document.getElementById('noTriviaScoresRow');
                if (noScoresRow) {
                    noScoresRow.remove();
                }
                
                // Clear existing rows
                tbody.innerHTML = '';
                
                // Add score rows
                triviaHighScores.forEach((score, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${score.score}</td>
                        <td>${score.date}</td>
                        <td>${score.correct}</td>
                    `;
                    tbody.appendChild(row);
                });
            };
            
            // Game event listeners
            if (startTriviaBtn) {
                startTriviaBtn.addEventListener('click', startTriviaGame);
            }
            
            if (stopTriviaBtn) {
                stopTriviaBtn.addEventListener('click', endTriviaGame);
            }
            
            // Load high scores on init
            const loadTriviaHighScores = () => {
                const savedScores = localStorage.getItem('footballTriviaHighScores');
                if (savedScores) {
                    triviaHighScores = JSON.parse(savedScores);
                    updateTriviaScoresTable();
                }
            };
            
            // Initialize high scores
            loadTriviaHighScores();
            
            // Add translations for football trivia
            if (translations.en) {
                translations.en.footballTrivia = "Football Trivia";
                translations.en.footballQuestion = "Football Question";
                translations.en.startTrivia = "Start Trivia";
                translations.en.endTrivia = "End Trivia";
                translations.en.correct = "Correct";
                translations.en.questions = "Questions";
                translations.en.true = "True";
                translations.en.false = "False";
                translations.en.correctAnswers = "Correct Answers";
                translations.en.noTriviaScores = "No trivia scores yet. Play the game to set your first score!";
            }
            
            if (translations.ar) {
                translations.ar.footballTrivia = "مسابقة كرة القدم";
                translations.ar.footballQuestion = "سؤال كرة القدم";
                translations.ar.startTrivia = "بدء المسابقة";
                translations.ar.endTrivia = "إنهاء المسابقة";
                translations.ar.correct = "صحيح";
                translations.ar.questions = "الأسئلة";
                translations.ar.true = "صحيح";
                translations.ar.false = "خطأ";
                translations.ar.correctAnswers = "إجابات صحيحة";
                translations.ar.noTriviaScores = "لا توجد نتائج للمسابقة حتى الآن. العب اللعبة لتسجيل أول نتيجة لك!";
            }
            
            // ==========================================================================
            // New AI Dashboard Functionality
            // ==========================================================================
            
            // Initialize status indicators
            const updateStatusIndicators = () => {
                // Gesture indicator
                const gestureIndicator = document.getElementById('gestureIndicator');
                if (gestureIndicator) {
                    if (document.getElementById('gestureStatus').classList.contains('text-success')) {
                        gestureIndicator.className = 'status-indicator active';
                    } else {
                        gestureIndicator.className = 'status-indicator';
                    }
                }
                
                // Voice indicator
                const voiceIndicator = document.getElementById('voiceIndicator');
                if (voiceIndicator) {
                    if (document.getElementById('voiceStatus').classList.contains('text-success')) {
                        voiceIndicator.className = 'status-indicator active';
                    } else {
                        voiceIndicator.className = 'status-indicator';
                    }
                }
                
                // Gesture config indicator
                const gestureConfigIndicator = document.getElementById('gestureConfigIndicator');
                if (gestureConfigIndicator) {
                    if (document.getElementById('gestureConfigStatus').classList.contains('text-success')) {
                        gestureConfigIndicator.className = 'status-indicator active';
                    } else {
                        gestureConfigIndicator.className = 'status-indicator danger';
                    }
                }
                
                // Voice enrollment indicator
                const voiceEnrollIndicator = document.getElementById('voiceEnrollIndicator');
                if (voiceEnrollIndicator) {
                    if (document.getElementById('voiceEnrollStatus').classList.contains('text-success')) {
                        voiceEnrollIndicator.className = 'status-indicator active';
                    } else {
                        voiceEnrollIndicator.className = 'status-indicator danger';
                    }
                }
                
                // Background mode indicator
                const backgroundModeIndicator = document.getElementById('backgroundModeIndicator');
                if (backgroundModeIndicator) {
                    if (document.getElementById('backgroundModeStatus').classList.contains('text-success')) {
                        backgroundModeIndicator.className = 'status-indicator active';
                    } else {
                        backgroundModeIndicator.className = 'status-indicator';
                    }
                }
                
                // Update progress bars
                const gestureProgress = document.getElementById('gestureProgress');
                if (gestureProgress) {
                    gestureProgress.style.width = document.getElementById('gestureStatus').classList.contains('text-success') ? '100%' : '0%';
                }
                
                const voiceProgress = document.getElementById('voiceProgress');
                if (voiceProgress) {
                    voiceProgress.style.width = document.getElementById('voiceStatus').classList.contains('text-success') ? '100%' : '0%';
                }
            };
            
            // Initialize analytics chart
            const initializeAnalyticsChart = () => {
                const ctx = document.getElementById('usageChart');
                if (!ctx) return;
                
                // Use Chart.js if available, otherwise create a simple fallback
                if (typeof Chart !== 'undefined') {
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Thumbs Up', 'Palm', 'Pinch', 'Point Up', 'Point Down', 'Victory'],
                            datasets: [{
                                label: 'Usage Count',
                                data: [12, 8, 5, 10, 7, 3],
                                backgroundColor: [
                                    'rgba(79, 70, 229, 0.8)',
                                    'rgba(79, 70, 229, 0.7)',
                                    'rgba(79, 70, 229, 0.6)',
                                    'rgba(79, 70, 229, 0.5)',
                                    'rgba(79, 70, 229, 0.4)',
                                    'rgba(79, 70, 229, 0.3)'
                                ],
                                borderColor: 'rgba(79, 70, 229, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        precision: 0
                                    }
                                }
                            }
                        }
                    });
                } else {
                    // Fallback to a simple representation
                    const container = document.querySelector('.chart-container');
                    if (container) {
                        container.innerHTML = `
                            <div class="d-flex justify-content-between text-center">
                                <div class="px-2">
                                    <div class="bg-primary" style="height: 80px; width: 20px;"></div>
                                    <small>👍</small>
                                </div>
                                <div class="px-2">
                                    <div class="bg-primary" style="height: 50px; width: 20px;"></div>
                                    <small>✋</small>
                                </div>
                                <div class="px-2">
                                    <div class="bg-primary" style="height: 30px; width: 20px;"></div>
                                    <small>👌</small>
                                </div>
                                <div class="px-2">
                                    <div class="bg-primary" style="height: 65px; width: 20px;"></div>
                                    <small>☝️</small>
                                </div>
                                <div class="px-2">
                                    <div class="bg-primary" style="height: 45px; width: 20px;"></div>
                                    <small>👇</small>
                                </div>
                                <div class="px-2">
                                    <div class="bg-primary" style="height: 20px; width: 20px;"></div>
                                    <small>✌️</small>
                                </div>
                            </div>
                        `;
                    }
                }
            };
            
            // Switch between status and analytics views
            const setupViewToggle = () => {
                const viewButtons = document.querySelectorAll('[data-view]');
                const statusView = document.getElementById('statusView');
                const analyticsView = document.getElementById('analyticsView');
                
                if (!viewButtons.length || !statusView || !analyticsView) return;
                
                viewButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        // Remove active class from all buttons
                        viewButtons.forEach(btn => btn.classList.remove('active'));
                        // Add active class to clicked button
                        this.classList.add('active');
                        
                        // Show the corresponding view
                        const viewName = this.getAttribute('data-view');
                        if (viewName === 'status') {
                            statusView.classList.remove('d-none');
                            analyticsView.classList.add('d-none');
                        } else if (viewName === 'analytics') {
                            statusView.classList.add('d-none');
                            analyticsView.classList.remove('d-none');
                            // Initialize chart if in analytics view
                            initializeAnalyticsChart();
                        }
                    });
                });
            };
            
            // Enhanced command history display with AI features
            const enhanceCommandHistory = () => {
                const commandHistory = document.getElementById('commandHistory');
                const commandCount = document.getElementById('commandCount');
                
                if (!commandHistory) return;
                
                // Original command history was already populated, now let's enhance it
                if (!commandHistory.classList.contains('d-none')) {
                    // Get existing commands
                    const existingCommands = commands.slice();
                    
                    // Clear and rebuild with enhanced format
                    commandHistory.innerHTML = '';
                    
                    existingCommands.forEach(command => {
                        const commandItem = document.createElement('div');
                        commandItem.className = 'command-item';
                        
                        // Get icon based on action
                        let iconPath = '';
                        if (command.action.includes('CAMERA')) {
                            iconPath = '<path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle>';
                        } else if (command.action.includes('PHOTO')) {
                            iconPath = '<path d="M12 3v10"></path><path d="m8 9 4 4 4-4"></path><path d="M8 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3"></path>';
                        } else if (command.action.includes('FLIP')) {
                            iconPath = '<path d="M12 3V2"></path><path d="M12 21v1"></path><path d="m5.64 5.64-.71-.71"></path><path d="m19.07 19.07-.71-.71"></path><path d="M3 12h1"></path><path d="M20 12h1"></path><path d="m5.64 18.36-.71.71"></path><path d="m19.07 4.93-.71.71"></path><path d="M17 12a5 5 0 0 0-10 0"></path><path d="M12 12v4"></path><path d="m9 14 3 3 3-3"></path>';
                        } else {
                            iconPath = '<path d="M9 3H5a2 2 0 0 0-2 2v4"></path><path d="M5 21h4"></path><path d="M16 3h4a2 2 0 0 1 2 2v4"></path><path d="M19 16v5"></path><path d="M9 21H5a2 2 0 0 1-2-2v-4"></path><path d="M14 3h2"></path><path d="M3 9v2"></path><path d="M21 9v2"></path><path d="M21 16a2 2 0 0 0-2-2h-2.5"></path><path d="M9 5v14"></path>';
                        }
                        
                        commandItem.innerHTML = `
                            <div class="command-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    ${iconPath}
                                </svg>
                            </div>
                            <div class="command-text">${command.action.replace(/_/g, ' ')}</div>
                            <div class="command-time">${command.timestamp}</div>
                        `;
                        
                        commandHistory.appendChild(commandItem);
                    });
                    
                    if (commandCount) {
                        commandCount.textContent = existingCommands.length;
                    }
                }
            };
            
            // Add AI Dashboard translations
            const addAIDashboardTranslations = () => {
                if (translations.en) {
                    // Welcome section
                    translations.en.welcomeHeader = "Welcome to Your AI Control Hub";
                    translations.en.welcomeMessage = "Control your device with intelligent gesture and voice recognition.";
                    translations.en.quickStartButton = "Quick Start Guide";
                    translations.en.aiTipsButton = "AI Tips";
                    
                    // Control panel
                    translations.en.aiPowered = "AI Powered";
                    translations.en.gestureDescription = "Control your device with hand movements";
                    translations.en.voiceDescription = "Control with voice commands";
                    translations.en.backgroundModeDescription = "Keep detection active when minimized";
                    
                    // Status dashboard
                    translations.en.statusDashboard = "Status Dashboard";
                    translations.en.statusView = "Status";
                    translations.en.analyticsView = "Analytics";
                    
                    // Analytics
                    translations.en.usageAnalytics = "Usage Analytics";
                    translations.en.aiInsight = "AI Insight: Your most used gestures are Thumbs Up and Point Up";
                    
                    // AI Insights
                    translations.en.aiInsights = "AI Insights";
                    translations.en.refreshButton = "Refresh";
                    translations.en.gesturePatterns = "Gesture Patterns";
                    translations.en.gesturePatternInsight = "You frequently use Palm → Thumbs Up in sequence. Set up a custom gesture combination for enhanced productivity.";
                    translations.en.suggestionTitle = "Suggested Training";
                    translations.en.trainingInsight = "Based on your usage, training the \"Point Down\" gesture would improve your workflow.";
                    translations.en.trainNowLink = "Train now";
                    translations.en.voiceAccuracy = "Voice Accuracy";
                    translations.en.voiceAccuracyInsight = "Voice recognition accuracy is at 85%. Try re-enrolling in a quieter environment for improved results.";
                    
                    // Commands
                    translations.en.aiSuggested = "AI Suggested Actions";
                    translations.en.openCameraAction = "Open Camera";
                    translations.en.takePhotoAction = "Take Photo";
                    translations.en.navigateBackAction = "Navigate Back";
                }
                
                if (translations.ar) {
                    // Welcome section
                    translations.ar.welcomeHeader = "مرحبًا بك في مركز التحكم الذكي";
                    translations.ar.welcomeMessage = "تحكم بجهازك من خلال تقنيات التعرف الذكية على الإيماءات والصوت.";
                    translations.ar.quickStartButton = "دليل البدء السريع";
                    translations.ar.aiTipsButton = "نصائح الذكاء الاصطناعي";
                    
                    // Control panel
                    translations.ar.aiPowered = "مدعوم بالذكاء الاصطناعي";
                    translations.ar.gestureDescription = "تحكم بجهازك بحركات اليد";
                    translations.ar.voiceDescription = "تحكم بالأوامر الصوتية";
                    translations.ar.backgroundModeDescription = "إبقاء الكشف نشطًا عند تصغير التطبيق";
                    
                    // Status dashboard
                    translations.ar.statusDashboard = "لوحة الحالة";
                    translations.ar.statusView = "الحالة";
                    translations.ar.analyticsView = "التحليلات";
                    
                    // Analytics
                    translations.ar.usageAnalytics = "تحليلات الاستخدام";
                    translations.ar.aiInsight = "رؤية الذكاء الاصطناعي: الإيماءات الأكثر استخدامًا هي الإبهام لأعلى والإشارة لأعلى";
                    
                    // AI Insights
                    translations.ar.aiInsights = "رؤى الذكاء الاصطناعي";
                    translations.ar.refreshButton = "تحديث";
                    translations.ar.gesturePatterns = "أنماط الإيماءات";
                    translations.ar.gesturePatternInsight = "أنت تستخدم كثيرًا كف اليد ← الإبهام لأعلى بالتسلسل. قم بإعداد مجموعة إيماءات مخصصة لتحسين الإنتاجية.";
                    translations.ar.suggestionTitle = "التدريب المقترح";
                    translations.ar.trainingInsight = "بناءً على استخدامك، فإن تدريب إيماءة \"الإشارة لأسفل\" من شأنه تحسين سير عملك.";
                    translations.ar.trainNowLink = "تدريب الآن";
                    translations.ar.voiceAccuracy = "دقة الصوت";
                    translations.ar.voiceAccuracyInsight = "دقة التعرف على الصوت هي 85%. حاول إعادة التسجيل في بيئة أكثر هدوءًا للحصول على نتائج أفضل.";
                    
                    // Commands
                    translations.ar.aiSuggested = "الإجراءات المقترحة من الذكاء الاصطناعي";
                    translations.ar.openCameraAction = "فتح الكاميرا";
                    translations.ar.takePhotoAction = "التقاط صورة";
                    translations.ar.navigateBackAction = "العودة للخلف";
                }
            };
            
            // Initialize AI dashboard after other components are ready
            const initAIDashboard = () => {
                updateStatusIndicators();
                setupViewToggle();
                enhanceCommandHistory();
                
                // Update quick start and AI tips buttons
                const quickStartBtn = document.querySelector('[data-translation-key="quickStartButton"]');
                if (quickStartBtn) {
                    quickStartBtn.addEventListener('click', function() {
                        alert('Quick Start Guide: 1. Configure gestures in the Gestures tab. 2. Enroll your voice in the Voice tab. 3. Enable controls in the Home tab.');
                    });
                }
                
                const aiTipsBtn = document.querySelector('[data-translation-key="aiTipsButton"]');
                if (aiTipsBtn) {
                    aiTipsBtn.addEventListener('click', function() {
                        alert('AI Tips: 1. Train gestures multiple times for better accuracy. 2. Use background mode for continuous gesture recognition. 3. Create custom gesture combinations for frequent tasks.');
                    });
                }
                
                // Update status indicators when toggles change
                const toggles = [gestureToggle, voiceToggle, backgroundModeToggle];
                toggles.forEach(toggle => {
                    if (toggle) {
                        toggle.addEventListener('change', function() {
                            // Let the original event handlers run first
                            setTimeout(updateStatusIndicators, 100);
                        });
                    }
                });
                
                // Add AI suggested actions click handlers
                const actionButtons = document.querySelectorAll('[data-translation-key$="Action"]');
                actionButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const actionKey = this.getAttribute('data-translation-key');
                        let action = '';
                        
                        if (actionKey === 'openCameraAction') {
                            action = 'OPEN_CAMERA';
                        } else if (actionKey === 'takePhotoAction') {
                            action = 'TAKE_PHOTO';
                        } else if (actionKey === 'navigateBackAction') {
                            action = 'GO_BACK';
                        }
                        
                        if (action) {
                            executeAction(action);
                        }
                    });
                });
            };
            
            // Add translations and initialize dashboard
            addAIDashboardTranslations();
            
            // Run after DOM is fully ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initAIDashboard);
            } else {
                initAIDashboard();
            }
        });
    </script>
</body>
</html>
